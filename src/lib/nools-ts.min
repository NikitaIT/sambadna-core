"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var _symbol=require("babel-runtime/core-js/symbol"),_symbol2=_interopRequireDefault(_symbol),_weakMap=require("babel-runtime/core-js/weak-map"),_weakMap2=_interopRequireDefault(_weakMap),_stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_keys3=require("babel-runtime/core-js/object/keys"),_keys4=_interopRequireDefault(_keys3),_toConsumableArray2=require("babel-runtime/helpers/toConsumableArray"),_toConsumableArray3=_interopRequireDefault(_toConsumableArray2),_create=require("babel-runtime/core-js/object/create"),_create2=_interopRequireDefault(_create),_set=require("babel-runtime/core-js/set"),_set2=_interopRequireDefault(_set),_getIterator2=require("babel-runtime/core-js/get-iterator"),_getIterator3=_interopRequireDefault(_getIterator2),_slicedToArray2=require("babel-runtime/helpers/slicedToArray"),_slicedToArray3=_interopRequireDefault(_slicedToArray2),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_map=require("babel-runtime/core-js/map"),_map2=_interopRequireDefault(_map),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_typeof2=require("babel-runtime/helpers/typeof"),_typeof3=_interopRequireDefault(_typeof2);!function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof3["default"](exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.nools=e()}}(function(){var define,module,exports;return function(){function e(t,r,n){function a(i,s){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return a(r?r:e)},l,l.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}return e}()({1:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=10,a=function(){function e(){_classCallCheck3["default"](this,e),this._events={},this.maxListeners=n}return _createClass3["default"](e,[{key:"setMaxListeners",value:function(e){this.maxListeners=e}},{key:"on",value:function(e,t){return this.addListener(e,t)}},{key:"addListener",value:function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");if(this.emit("newListener",e,t),this._events[e]){if(!this._events[e].warned){var r=this.maxListeners;r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}this._events[e].push(t)}else this._events[e]=[t];return this}},{key:"emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];if("error"===e&&!this._events.error)throw r[0]instanceof Error?r[0]:new Error("Uncaught, unspecified 'error' event.");var a=this._events[e];return a&&a?(a.forEach(function(e){e.apply(void 0,r)}),!0):!1}},{key:"once",value:function(e,t){var r=this;return this.on(e,function n(){r.removeListener(e,n),t.apply(void 0,arguments)}),this}},{key:"removeListener",value:function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e];if(r){var n=r.indexOf(t);if(0>n)return this;r.splice(n,1),0==r.length&&delete this._events[e]}return this}},{key:"removeAllListeners",value:function(e){return void 0===e?(this._events={},this):(e&&this._events[e]&&(delete this._events[e],this._events[e]=null),this)}},{key:"listeners",value:function(e){return this._events[e]||[]}},{key:"listenerCount",value:function(e,t){var r=0;return e._events[t]&&(r=e._events[t].length),r}}]),e}();r["default"]=a},{}],2:[function(e,t,r){function n(){return new _map2["default"]}function a(e,t){var r=t.hashCode,n=e,a=n.get(r);return a&&n["delete"](r),a}function o(e,t){var r=t.hashCode,n=e;if(n.has(r))throw new Error("Activation already in agenda "+t.rule.n+" agenda");n.set(r,t)}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./EventEmitter"),s=e("./leafy/avl-tree"),u="main",c=function(e){function t(e,r){_classCallCheck3["default"](this,t);var n=_possibleConstructorReturn3["default"](this,(t.__proto__||_getPrototypeOf2["default"](t)).call(this));return n.agendaGroupStack=[u],n.agendaGroups=new _map2["default"],n.rules={},n.flow=e,n.comparator=r,n.setFocus(u).addAgendaGroup(u),n}return _inherits3["default"](t,e),_createClass3["default"](t,[{key:"addAgendaGroup",value:function(e){this.agendaGroups.has(e)||this.agendaGroups.set(e,new s["default"](this.comparator))}},{key:"getAgendaGroup",value:function(e){return this.agendaGroups.get(e||u)}},{key:"setFocus",value:function(e){return e!==this.getFocused()&&this.agendaGroups.has(e)&&(this.agendaGroupStack.push(e),this.emit("focused",e)),this}},{key:"getFocused",value:function(){var e=this.agendaGroupStack;return e[e.length-1]}},{key:"getFocusedAgenda",value:function(){return this.agendaGroups.get(this.getFocused())}},{key:"register",value:function(e){var t=e.r.g;return this.rules[e.n]={tree:new s["default"](this.comparator),factTable:n()},t&&this.addAgendaGroup(t),e}},{key:"isEmpty",value:function(){for(var e=this.agendaGroupStack,t=!1;this.getFocusedAgenda().isEmpty()&&this.getFocused()!==u;)e.pop(),t=!0;return t&&this.emit("focused",this.getFocused()),this.getFocusedAgenda().isEmpty()}},{key:"fireNext",value:function(){for(var e=this.agendaGroupStack;this.getFocusedAgenda().isEmpty()&&this.getFocused()!==u;)e.pop();if(this.getFocusedAgenda().isEmpty())return new _promise2["default"](function(e){e()});var t=this.pop();return this.emit("fire",t.rule.n,t.match.factHash),t.rule.fire(this.flow,t.match)}},{key:"pop",value:function(){for(var e=this.getFocusedAgenda(),t=e.get_root();t.right;)t=t.right;var r=t.data;e.remove(r);var n=this.rules[r.name];return n.tree.remove(r),a(n.factTable,r),r}},{key:"peek",value:function(){for(var e=this.getFocusedAgenda(),t=e.get_root();t.right;)t=t.right;return t.data}},{key:"modify",value:function(e,t){this.retract(e,t),this.insert(e,t)}},{key:"retract",value:function(e,t){var r=this.rules[e.n];t.rule=e;var n=a(r.factTable,t);n&&(this.getAgendaGroup(e.r.g).remove(n),r.tree.remove(n))}},{key:"insert",value:function(e,t){var r=this.rules[e.n],n=e.r,a=n.g;r.tree.insert(t),this.getAgendaGroup(a).insert(t),n.af&&this.setFocus(a),o(r.factTable,t)}},{key:"dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var a,o=_getIterator3["default"](this.agendaGroups);!(e=(a=o.next()).done);e=!0){var i=a.value,s=_slicedToArray3["default"](i,2),u=(s[0],s[1]);u.clear()}}catch(c){t=!0,r=c}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw r}}var l=this.rules;for(var f in l)l[f].tree.clear(),l[f].factTable=n();this.rules={}}}]),t}(i["default"]);r["default"]=c},{"./EventEmitter":1,"./leafy/avl-tree":26}],3:[function(require,module,exports){function get_defines(e){var t=lang_1.to_map(e);return t.set("Array",Array),t.set("array",Array),t.set("String",String),t.set("string",String),t.set("Number",Number),t.set("number",Number),t.set("Boolean",Boolean),t.set("boolean",Boolean),t.set("RegExp",RegExp),t.set("regexp",RegExp),t.set("reg",RegExp),t.set("Date",Date),t.set("date",Date),t.set("Object",Object),t.set("object",Object),t.set("InitialFact",initial_1["default"]),t.set("initialfact",initial_1["default"]),t}function createFunction(body,defined,scope){var declares=[];defined.forEach(function(e,t){-1!==body.indexOf(t)&&declares.push("const "+t+"= defined.get('"+t+"');")}),scope.forEach(function(e,t){-1!==body.indexOf(t)&&declares.push("const "+t+"= scope.get('"+t+"');")}),body=["((function(){",declares.join(""),"\n	return ",body,"\n})())"].join("");try{return eval(body)}catch(e){throw new Error("Invalid action : "+body+"\n"+e.message)}}function createDefined(e,t,r){if(isString_1["default"](e)){var n=keys_1["default"](t).filter(function(t){return-1!==e.indexOf(t)}).map(function(e){return"var "+e+"=defined.get('"+e+"');"}).concat(keys_1["default"](r).filter(function(t){return-1!==e.indexOf(t)}).map(function(e){return"var "+e+"= function(){var prop=scope.get('"+e+"'); return __objToStr__.call(prop)==='[object Function]' ? prop.apply(void 0, arguments) : prop;};"}));n.length&&n.unshift("var __objToStr__ = Object.prototype.toString;"),e=[n.join(""),"return ",e,";"].join(""),e=new Function("defined","scope",e)(t,r)}var a=e.hasOwnProperty("constructor")&&"function"==typeof e.constructor?e.constructor:function(t){t=t||{};for(var r in t)r in e&&(a[r]=t[r])},o=a.prototype;for(var i in e)o[i]=e[i];return a}function compile(e,t){return index_1["default"](e,t)}Object.defineProperty(exports,"__esModule",{value:!0});var isString_1=require("lodash-ts/isString"),keys_1=require("lodash-ts/keys"),initial_1=require("./facts/initial"),lang_1=require("./lang"),index_1=require("./compile/index");exports.get_defines=get_defines,exports.createFunction=createFunction,exports.createDefined=createDefined,exports.compile=compile,exports["default"]=compile},{"./compile/index":6,"./facts/initial":21,"./lang":25,"lodash-ts/isString":90,"lodash-ts/keys":94}],4:[function(e,t,r){function n(e,t,r){if(e.length){var a=[],o=[],i=e[0];if("not"===i||"exists"===i){e.shift();var s=g(e,t,r),u=_slicedToArray3["default"](s,3),c=u[0],l=u[1],f=u[2];if(o=o.concat(c),f){var h=f.filter(function(e){return-1==o.indexOf(e)});h.length&&(o=o.concat(h))}l.unshift(i),a.push(l)}else if("or"===i){var p=[i];e.shift(),e.forEach(function(e){var a=n(e,t,r),i=_slicedToArray3["default"](a,2),s=i[0],u=i[1];p=p.concat(u),o=o.concat(s)}),a.push(p)}else{var y=g(e,t,r),_=_slicedToArray3["default"](y,3),m=_[0],v=_[1],b=_[2];if(a.push(v),o=o.concat(m),b){var T=b.filter(function(e){return-1==o.indexOf(e)});T.length&&(o=o.concat(T))}o=d.removeDups(o)}return[o,a]}return[[],[]]}function a(e){var t=new _set2["default"];return function(r,n){return r.filter(function(t){return-1!==e.indexOf(t)}).map(function(e){return t.has(e)?n+".has('"+e+"') && ("+e+" = "+n+".get('"+e+"'));":(t.add(e),"var "+e+" = "+n+".get('"+e+"');")})}}function o(e,t,r,n){var o=a(e),i=o(t,"facts").concat(o(f["default"](r),"defined")).concat(o(f["default"](n),"scope"));return m.forEach(function(t){-1!==e.indexOf(t)&&i.push("const "+t+"=(...args)=>{flow."+t+"(...args)};")}),e=i.join("")+e,e.trim()}function i(e,t,r,a){var i=e.name;if(u["default"](e))throw new Error("Rule is empty");var s=e.options||{};s.scope=r;var c=e.constraints||[],l=c.length;l||(c=[["initialfact","__o__"]]);var f=e.action;if(void 0===f)throw new Error("No action was defined for rule "+i);var d=[],h=[];return c.forEach(function(e){var r=n(e,t,i),a=_slicedToArray3["default"](r,2),o=a[0],s=a[1];d=d.concat(s),h=h.concat(o)}),_.createRule(i,s,d,a,o(f,h,t,r))}function s(e,t){var r=h.get_defines(t.define),n=d.to_map(t.scope);e.define.forEach(function(e){r.set(e.name,h.createDefined(e,r,n))}),e.scope.forEach(function(e){n.set(e.name,h.createFunction(e.body,r,n))});var a=e.rules,o=[];return{rules:a.reverse().reduce(function(e,t){return e.concat(i(t,r,n,o))},[]),cs:o}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("lodash-ts/isEmpty"),c=e("lodash-ts/isHash"),l=e("lodash-ts/isObject"),f=e("lodash-ts/keys"),d=e("../lang"),h=e("../compile"),p=e("../constraint-matcher"),y=e("./parser/constraint"),_=e("./rule"),g=function(e,t,r){var n=[],a=e[1],o=e[2],i=e[3];c["default"](o)&&(i=o,o=null);var s=e[0];if(!s||!(s=t.get(s)))throw new Error("Invalid class "+e[0]+" for rule "+r);n.push([e[0],s]),n.push(a,o,i);var u=[a];if(o&&(u=u.concat(p.getIdentifiers(y["default"](o)))),l["default"](i)){var f=[];for(var d in i){var h=i[d];-1===u.indexOf(h)&&f.push(h)}return[u,n,f]}return[u,n]},m=["assert","modify","retract","emit","halt","focus","getFacts"];r["default"]=s},{"../compile":3,"../constraint-matcher":16,"../lang":25,"./parser/constraint":8,"./rule":14,"lodash-ts/isEmpty":80,"lodash-ts/isHash":83,"lodash-ts/isObject":87,"lodash-ts/keys":94}],5:[function(e,t,r){function n(e){return delete e.assert,delete e.equal,e}function a(e){var t=e.scope,r=e.scope2={};if(t){var n=!0,a=!1,o=void 0;try{for(var i,s=_getIterator3["default"](t.entries());!(n=(i=s.next()).done);n=!0){var u=i.value,c=_slicedToArray3["default"](u,2),l=c[0],f=c[1];r[l]=f}}catch(d){a=!0,o=d}finally{try{!n&&s["return"]&&s["return"]()}finally{if(a)throw o}}delete e.scope}return e}function o(e){return delete e.assert,delete e.equal,e.options=a(e.options),e}function i(e){return delete e.constraint,delete e.assert,delete e.equal,e}function s(e){return delete e.constraint,delete e.assert,delete e.equal,e.options=a(e.options),e}function u(e){return delete e.assert,delete e.equal,delete e.getIndexableProperties,e.options=a(e.options),e}function c(e){var t=f.get(e.tp);return t(e)}Object.defineProperty(r,"__esModule",{value:!0});var l=e("../constraint"),f=new _map2["default"];f.set(l.constraintType["true"],n),f.set(l.constraintType.equality,o),f.set(l.constraintType.inequality,o),f.set(l.constraintType.comparison,o),f.set(l.constraintType.object,i),f.set(l.constraintType.hash,n),f.set(l.constraintType.from,s),f.set(l.constraintType.reference,u),f.set(l.constraintType.reference_equality,u),f.set(l.constraintType.reference_inequality,u),f.set(l.constraintType.reference_gt,u),f.set(l.constraintType.reference_gte,u),f.set(l.constraintType.reference_lt,u),f.set(l.constraintType.reference_lte,u),r["default"]=c},{"../constraint":17}],6:[function(e,t,r){function n(e,t){if(!a["default"](e))return null;var r={define:[],rules:[],scope:[]};s["default"](e,i["default"],r);var n=o["default"](r,t),c=u["default"](n.rules,n.cs);return c}Object.defineProperty(r,"__esModule",{value:!0});var a=e("lodash-ts/isString"),o=e("./compile"),i=e("./parser/tokens"),s=e("./parser/parse"),u=e("./nodes");r["default"]=n},{"./compile":4,"./nodes":7,"./parser/parse":10,"./parser/tokens":11,"lodash-ts/isString":90}],7:[function(e,t,r){function n(e){return{ns:[],ps:[],ts:[],js:[],as:[],cs:e,tps:[],bucket:{counter:0,recency:0}}}function a(e){return{tp:e,ns:[],id:ie++,ps:[]}}function o(e,t,r){var n=e[t],o=Q["default"](a(Y.nodeType.terminal),{i:t,r:n,n:n.n,b:r});return o}function i(e,t){var r=n(t);return e.forEach(function(t,n){var a=o(e,n,r.bucket),i=r.ns.push(a)-1;F(r,n,t.pt,i),d(r),r.ts.push(i)}),r}function s(e,t){return(e.constraints||[]).some(function(e){return J.is_instance_of_reference_constraint(t[e])})}function u(e,t,r){e.ns.push([t,r])}function c(e,t){var r=e.ps;-1===r.indexOf(t)&&r.push(t)}function l(e,t,r){var n=r[e],a=r[t],o=!0,i=!1,s=void 0;try{for(var l,f=_getIterator3["default"](a.ns.entries());!(o=(l=f.next()).done);o=!0){var d=l.value,h=_slicedToArray3["default"](d,2),p=(h[0],_slicedToArray3["default"](h[1],2));p[0],p[1]}}catch(y){i=!0,s=y}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw s}}return a.ns.forEach(function(e){var t=_slicedToArray3["default"](e,2),r=t[0],a=t[1];u(n,r,a)}),a.ns=[],a.ps.forEach(function(e){c(n,e),r[e].ns=r[e].ns.filter(function(e){{var r=_slicedToArray3["default"](e,2),n=r[0];r[1]}return n!=t})}),n}function f(e){switch(e.tp){case Y.nodeType.not:case Y.nodeType.exists:case Y.nodeType.join:case Y.nodeType.from:case Y.nodeType.from_not:case Y.nodeType.exists_from:case Y.nodeType.beta:return!0;default:return!1}}function d(e){for(var t=e.js,r=e.ns,n=0;n<t.length;n++){var a=t[n],o=t[n+1],i=r[a],s=r[o];i&&s&&i.constraint&&s.constraint&&i.constraint.constraint.equal(s.constraint.constraint)&&(l(a,o,r),t.splice(n+1,1))}}function h(e,t){var r=e.as,n=-1;return r.some(function(r){var a=e.ns[r],o=t.eq(a);return o&&(n=r),o})?n:(n=e.ns.push(t)-1,r.push(n),n)}function p(e,t,r){return Q["default"](a(e),{constraint:t,c:r,ca:t.assert,eq:function(e){return t.equal(e.constraint)}})}function y(e,t,r){var n=p(Y.nodeType.type,t,r),a=e.tps,o=-1;return a.some(function(t){var r=e.ns[t],a=n.constraint.equal(r.constraint);return a&&(o=t),a})?o:(o=e.ns.push(n)-1,a.push(o),o)}function _(e,t){return Q["default"](p(Y.nodeType.equality,e,t),{memory:new _map2["default"]})}function g(e,t,r,n){return h(e,_(r,n))}function m(e,t){return Q["default"](p(Y.nodeType.property,e,t),{alias:e.a,constiables:e.constraint})}function v(e,t,r,n){return h(e,m(r,n))}function b(e,t){var r=e.ps[t],n=r.a;return Q["default"](a(Y.nodeType.alias),{alias:n,constraint:r,p:t,eq:function(e){return e.tp==Y.nodeType.alias&&n===e.alias}})}function T(e,t,r){return h(e,b(e,r))}function k(e){return a(e?Y.nodeType.leftadapter:Y.nodeType.rightadapter)}function w(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",r=k("left"===t);return e.ns.push(r)-1}function x(e){return Q["default"](a(e),{leftMemory:{},rightMemory:{},leftTuples:ee["default"](),rightTuples:ee["default"]()})}function j(){return x(Y.nodeType.beta)}function M(e){var t=x(e),r=ne.create_join_reference_node(t.leftTuples,t.rightTuples);return Q["default"](t,{constraint:r})}function E(){return M(Y.nodeType.join)}function O(e){return Q["default"](M(e),{leftTupleMemory:{},notMatch:new te["default"](new re["default"]).match})}function A(){return O(Y.nodeType.not)}function C(){return O(Y.nodeType.exists)}function q(e,t,r){var n=e.ps.push(r)-1,a=e.cs,o=a[r.constraints[0]],i=r.from,s=r.constraints.slice(1).map(function(e){return a[e]}),u=[],c=[];return s.forEach(function(e){J.is_instance_of_equality(e)||J.is_instance_of_reference_constraint(e)?c.push(function(t,r){return e.assert(t,r)}):J.is_instance_of_hash(e)&&(u=u.concat(e.constraint))}),Q["default"](M(t),{pattern:r,p:n,alias:r.a,constraints:s,__equalityConstraints:c,__variables:u,fromMemory:{},type_assert:function(e){return o.assert(e)},from_assert:function(e,t){return i.assert(e,t)}})}function L(e,t){return q(e,Y.nodeType.from,t)}function P(e,t,r){var n=e.ps.push(r)-1,a=e.cs,o=a[r.constraints[0]],i=r.from,s=r.constraints.slice(1).map(function(e){return a[e]}),u=[],c=[];return s.forEach(function(e){J.is_instance_of_equality(e)||J.is_instance_of_reference_constraint(e)?c.push(e.assert):J.is_instance_of_hash(e)&&(u=u.concat(e.constraint))}),Q["default"](M(t),{pattern:r,p:n,alias:r.a,constraints:s,__equalityConstraints:c,__variables:u,fromMemory:{},type_assert:function(e){return o.assert(e)},from_assert:function(e,t){return i.assert(e,t)}})}function I(e,t){return P(e,Y.nodeType.from_not,t)}function S(e,t){return P(e,Y.nodeType.exists_from,t)}function R(e,t,r,n,a){var o=void 0,i=-1,c=e.ns,l=r.rightPattern.tp;if(l===K.patternType.not)o=A(),i=c.push(o)-1;else if(l===K.patternType.from_exists)o=S(e,r.rightPattern),i=c.push(o)-1;else if(l===K.patternType.exists)o=C(),i=c.push(o)-1;else if(l===K.patternType.from_not)o=I(e,r.rightPattern),i=c.push(o)-1;else if(l===K.patternType.from)o=L(e,r.rightPattern),i=c.push(o)-1;else if(r.tp!==K.patternType.composite||s(r.leftPattern,e.cs)||s(r.rightPattern,e.cs))o=E(),i=c.push(o)-1,e.js.push(i);else{var d=o=j();i=c.push(d)-1,e.js.push(i)}var h=o;if(f(c[n])){var p=w(e,t,a);u(h,p,-1),h=c[p]}return u(h,n,-1),i}function F(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"left",o=r.tp;o===K.patternType.composite?N(e,t,r,n,a):o!==K.patternType.initial_fact&&"left"===a?N(e,t,K.composite_pattern(K.initial_fact_pattern(e.cs),r),n,a):$(e,t,r,n,a)}function N(e,t,r,n,a){var o=e.ns,i=o[n],s=R(e,t,r,n,a);return F(e,t,r.rightPattern,s,"right"),F(e,t,r.leftPattern,s,"left"),c(i,s),s}function $(e,t,r,n,a){var o=e.ps.push(r)-1,i=r.tp;if(i!==K.patternType.from&&i!==K.patternType.from_exists&&i!==K.patternType.from_not){var s=e.ns,l=s[n],d=r.constraints,h=e.cs,p=y(e,h[d[0]],d[0]),_=s[p],m=T(e,t,o);u(_,m,o),c(s[m],p);var b=m;if(d.filter(function(e,t){return t>0}).forEach(function(r){var n=h[r],a=-1;if(J.is_instance_of_hash(n))a=v(e,t,n,r);else{if(J.is_instance_of_reference_constraint(n))return void ne.addConstraint(l.constraint,n);a=g(e,t,n,r)}var i=s[a];u(s[b],a,o),c(i,b),b=a}),f(l)){var k=w(e,t,a);c(s[k],b),u(s[b],k,o),b=k}c(l,b),u(s[b],n,o)}}function D(e){return delete e.b,delete e.r.pt,e}function H(e){return delete e.eq,delete e.ca,delete e.constraint,e}function B(e){return delete e.eq,delete e.ca,delete e.memory,delete e.constraint,e}function G(e){return delete e.eq,delete e.ca,delete e.constraint,e}function U(e){return delete e.eq,delete e.constraint,e}function W(e){return delete e.leftMemory,delete e.leftTuples,delete e.rightMemory,delete e.rightTuples,e}function X(e){e=W(e);var t=e.constraint;delete t.leftMemory,delete t.rightMemory,delete t.equal,delete t.isMatch,delete t.match;var r=t.constraint;return delete r.merge,delete r.getIndexableProperties,e}function z(e){return e=X(e),delete e.leftTupleMemory,delete e.notMatch,e}function V(e){return e=X(e),delete e.__equalityConstraints,delete e.fromMemory,delete e.type_assert,delete e.from_assert,delete e.pattern,e}function Z(e,t){var r=i(e,t);return r.ns=r.ns.map(function(e){var t=se.get(e.tp);return t?t(e):e}),r.ps=r.ps.map(oe["default"]),r.cs=t.map(ae["default"]),delete r.as,delete r.js,r}Object.defineProperty(r,"__esModule",{value:!0});var Q=e("lodash-ts/mixin"),Y=e("../nodes"),K=e("../pattern"),J=e("../constraint"),ee=e("../nodes/misc/memory"),te=e("../context"),re=e("../facts/initial"),ne=e("../nodes/join-reference-node"),ae=e("./constraint"),oe=e("./pattern"),ie=0;r.create_node=a;var se=new _map2["default"];se.set(Y.nodeType.terminal,D),se.set(Y.nodeType.type,H),se.set(Y.nodeType.equality,B),se.set(Y.nodeType.property,G),se.set(Y.nodeType.alias,U),se.set(Y.nodeType.beta,W),se.set(Y.nodeType.join,X),se.set(Y.nodeType.not,z),se.set(Y.nodeType.exists,z),se.set(Y.nodeType.from,V),se.set(Y.nodeType.from_not,V),se.set(Y.nodeType.exists_from,V),r["default"]=Z},{"../constraint":17,"../context":18,"../facts/initial":21,"../nodes":29,"../nodes/join-reference-node":38,"../nodes/misc/memory":41,"../pattern":51,"./constraint":5,"./pattern":13,"lodash-ts/mixin":95}],8:[function(e,t,r){function n(e){return a.parse(e)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./constraint/parser");r["default"]=n},{"./constraint/parser":9}],9:[function(e,t,r){(function(n){var a=function(){function e(){this.yy={}}var t=function(e,t,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=t);return r},r=[1,29],n=[1,30],a=[1,26],o=[1,24],i=[1,16],s=[1,18],u=[1,19],c=[1,20],l=[1,21],f=[1,22],d=[5,38,49],h=[1,33],p=[5,36,38,49],y=[5,8,11,12,13,15,17,19,20,21,22,24,25,26,27,28,29,36,38,49],_=[2,2],g=[5,24,25,26,27,28,29,36,38,49],m=[1,42],v=[1,43],b=[1,44],T=[1,45],k=[5,8,11,12,13,15,17,19,20,21,22,24,25,26,27,28,29,31,33,36,38,40,46,49],w=[1,46],x=[1,47],j=[1,48],M=[5,19,20,21,22,24,25,26,27,28,29,36,38,49],E=[1,50],O=[5,8,11,12,13,15,17,19,20,21,22,24,25,26,27,28,29,31,33,36,38,40,43,44,46,48,49],A=[5,17,19,20,21,22,24,25,26,27,28,29,36,38,49],C=[1,55],q=[1,54],L=[5,8,15,17,19,20,21,22,24,25,26,27,28,29,36,38,49],P=[1,56],I=[1,57],S=[1,58],R=[1,87],F=[40,46,49],N={trace:function(){},yy:{},symbols_:{error:2,expressions:3,EXPRESSION:4,EOF:5,UNARY_EXPRESSION:6,LITERAL_EXPRESSION:7,"-":8,"!":9,MULTIPLICATIVE_EXPRESSION:10,"*":11,"/":12,"%":13,ADDITIVE_EXPRESSION:14,"+":15,EXPONENT_EXPRESSION:16,"^":17,RELATIONAL_EXPRESSION:18,"<":19,">":20,"<=":21,">=":22,EQUALITY_EXPRESSION:23,"==":24,"===":25,"!=":26,"!==":27,"=~":28,"!=~":29,IN_EXPRESSION:30,"in":31,ARRAY_EXPRESSION:32,notIn:33,OBJECT_EXPRESSION:34,AND_EXPRESSION:35,"&&":36,OR_EXPRESSION:37,"||":38,ARGUMENT_LIST:39,",":40,IDENTIFIER_EXPRESSION:41,IDENTIFIER:42,".":43,"[":44,STRING_EXPRESSION:45,"]":46,NUMBER_EXPRESSION:47,"(":48,")":49,STRING:50,NUMBER:51,REGEXP_EXPRESSION:52,REGEXP:53,BOOLEAN_EXPRESSION:54,BOOLEAN:55,NULL_EXPRESSION:56,NULL:57,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"-",9:"!",11:"*",12:"/",13:"%",15:"+",17:"^",19:"<",20:">",21:"<=",22:">=",24:"==",25:"===",26:"!=",27:"!==",28:"=~",29:"!=~",31:"in",33:"notIn",36:"&&",38:"||",40:",",42:"IDENTIFIER",43:".",44:"[",46:"]",48:"(",49:")",50:"STRING",51:"NUMBER",53:"REGEXP",55:"BOOLEAN",57:"NULL"},productions_:[0,[3,2],[6,1],[6,2],[6,2],[10,1],[10,3],[10,3],[10,3],[14,1],[14,3],[14,3],[16,1],[16,3],[18,1],[18,3],[18,3],[18,3],[18,3],[23,1],[23,3],[23,3],[23,3],[23,3],[23,3],[23,3],[30,1],[30,3],[30,3],[30,3],[30,3],[35,1],[35,3],[37,1],[37,3],[39,1],[39,3],[41,1],[34,1],[34,3],[34,4],[34,4],[34,4],[34,3],[34,4],[45,1],[47,1],[52,1],[54,1],[56,1],[32,2],[32,3],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,3],[4,1]],performAction:function(e,t,r,n,a,o){var i=o.length-1;switch(a){case 1:return o[i-1];case 3:this.$=[o[i],null,"unary"];break;case 4:this.$=[o[i],null,"logicalNot"];break;case 6:this.$=[o[i-2],o[i],"mult"];break;case 7:this.$=[o[i-2],o[i],"div"];break;case 8:this.$=[o[i-2],o[i],"mod"];break;case 10:this.$=[o[i-2],o[i],"plus"];break;case 11:this.$=[o[i-2],o[i],"minus"];break;case 13:this.$=[o[i-2],o[i],"pow"];break;case 15:this.$=[o[i-2],o[i],"lt"];break;case 16:this.$=[o[i-2],o[i],"gt"];break;case 17:this.$=[o[i-2],o[i],"lte"];break;case 18:this.$=[o[i-2],o[i],"gte"];break;case 20:this.$=[o[i-2],o[i],"eq"];break;case 21:this.$=[o[i-2],o[i],"seq"];break;case 22:this.$=[o[i-2],o[i],"neq"];break;case 23:this.$=[o[i-2],o[i],"sneq"];break;case 24:this.$=[o[i-2],o[i],"like"];break;case 25:this.$=[o[i-2],o[i],"notLike"];break;case 27:case 29:this.$=[o[i-2],o[i],"in"];break;case 28:case 30:this.$=[o[i-2],o[i],"notIn"];break;case 32:this.$=[o[i-2],o[i],"and"];break;case 34:this.$=[o[i-2],o[i],"or"];break;case 36:this.$=[o[i-2],o[i],"arguments"];break;case 37:this.$=[String(e),null,"identifier"];break;case 39:this.$=[o[i-2],o[i],"prop"];break;case 40:case 41:case 42:this.$=[o[i-3],o[i-1],"propLookup"];break;case 43:this.$=[o[i-2],[null,null,"arguments"],"function"];break;case 44:this.$=[o[i-3],o[i-1],"function"];break;case 45:this.$=[String(e.replace(/^['|"]|['|"]$/g,"")),null,"string"];break;case 46:this.$=[Number(e),null,"number"];break;case 47:this.$=[e,null,"regexp"];break;case 48:this.$=["true"==e.replace(/^\s+/,""),null,"boolean"];break;case 49:this.$=[null,null,"null"];break;case 50:this.$=[null,null,"array"];break;case 51:this.$=[o[i-1],null,"array"];break;case 59:this.$=[o[i-1],null,"composite"]}},table:[{3:1,4:2,6:28,7:7,8:r,9:n,10:27,14:25,16:17,18:8,23:6,30:5,32:15,34:14,35:4,37:3,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{1:[3]},{5:[1,31]},t([5,49],[2,60],{38:[1,32]}),t(d,[2,33],{36:h}),t(p,[2,31]),t(p,[2,26],{24:[1,34],25:[1,35],26:[1,36],27:[1,37],28:[1,38],29:[1,39]}),t(y,_,{31:[1,40],33:[1,41]}),t(g,[2,19],{19:m,20:v,21:b,22:T}),t(k,[2,52]),t(k,[2,53]),t(k,[2,54]),t(k,[2,55]),t(k,[2,56]),t(k,[2,57],{43:w,44:x,48:j}),t(k,[2,58]),{4:49,6:28,7:7,8:r,9:n,10:27,14:25,16:17,18:8,23:6,30:5,32:15,34:14,35:4,37:3,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},t(M,[2,14],{17:E}),t(k,[2,45]),t(k,[2,46]),t(k,[2,47]),t(k,[2,48]),t(k,[2,49]),t(O,[2,38]),{7:53,32:15,34:14,39:52,41:23,42:a,44:o,45:9,46:[1,51],47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},t(A,[2,12],{8:C,15:q}),t(O,[2,37]),t(L,[2,9],{11:P,12:I,13:S}),t(y,[2,5]),{6:59,7:60,8:r,9:n,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:61,7:60,8:r,9:n,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{1:[2,1]},{6:28,7:7,8:r,9:n,10:27,14:25,16:17,18:8,23:6,30:5,32:15,34:14,35:62,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:7,8:r,9:n,10:27,14:25,16:17,18:8,23:6,30:63,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:17,18:64,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:17,18:65,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:17,18:66,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:17,18:67,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:17,18:68,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:17,18:69,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{32:70,34:71,41:23,42:a,44:o},{32:72,34:73,41:23,42:a,44:o},{6:28,7:60,8:r,9:n,10:27,14:25,16:74,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:75,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:76,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:27,14:25,16:77,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{41:78,42:a},{34:81,41:23,42:a,45:79,47:80,50:s,51:u},{7:53,32:15,34:14,39:83,41:23,42:a,44:o,45:9,47:10,48:i,49:[1,82],50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{49:[1,84]},{6:28,7:60,8:r,9:n,10:27,14:85,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},t(k,[2,50]),{40:R,46:[1,86]},t(F,[2,35]),{6:28,7:60,8:r,9:n,10:88,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:28,7:60,8:r,9:n,10:89,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:90,7:60,8:r,9:n,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:91,7:60,8:r,9:n,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},{6:92,7:60,8:r,9:n,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},t(y,[2,3]),t(y,_),t(y,[2,4]),t(d,[2,34],{36:h}),t(p,[2,32]),t(g,[2,20],{19:m,20:v,21:b,22:T}),t(g,[2,21],{19:m,20:v,21:b,22:T}),t(g,[2,22],{19:m,20:v,21:b,22:T}),t(g,[2,23],{19:m,20:v,21:b,22:T}),t(g,[2,24],{19:m,20:v,21:b,22:T}),t(g,[2,25],{19:m,20:v,21:b,22:T}),t(p,[2,27]),t(p,[2,29],{43:w,44:x,48:j}),t(p,[2,28]),t(p,[2,30],{43:w,44:x,48:j}),t(M,[2,15],{17:E}),t(M,[2,16],{17:E}),t(M,[2,17],{17:E}),t(M,[2,18],{17:E}),t(O,[2,39]),{46:[1,93]},{46:[1,94]},{43:w,44:x,46:[1,95],48:j},t(O,[2,43]),{40:R,49:[1,96]},t(k,[2,59]),t(A,[2,13],{8:C,15:q}),t(k,[2,51]),{7:97,32:15,34:14,41:23,42:a,44:o,45:9,47:10,48:i,50:s,51:u,52:11,53:c,54:12,55:l,56:13,57:f},t(L,[2,10],{11:P,12:I,13:S}),t(L,[2,11],{11:P,12:I,13:S}),t(y,[2,6]),t(y,[2,7]),t(y,[2,8]),t(O,[2,40]),t(O,[2,41]),t(O,[2,42]),t(O,[2,44]),t(F,[2,36])],defaultActions:{31:[2,1]},parseError:function(e,t){if(!t.recoverable){var r=new Error(e);throw r.hash=t,r}this.trace(e)},parse:function(e){function t(){var e;return e=a.pop()||y.lex()||h,"number"!=typeof e&&(e instanceof Array&&(a=e,e=a.pop()),e=r.symbols_[e]||e),e}var r=this,n=[0],a=[],o=[null],i=[],s=this.table,u="",c=0,l=0,f=0,d=2,h=1,p=i.slice.call(arguments,1),y=_create2["default"](this.lexer),_={yy:{}};for(var g in this.yy)Object.prototype.hasOwnProperty.call(this.yy,g)&&(_.yy[g]=this.yy[g]);y.setInput(e,_.yy),_.yy.lexer=y,_.yy.parser=this,"undefined"==typeof y.yylloc&&(y.yylloc={});var m=y.yylloc;i.push(m);
var v=y.options&&y.options.ranges;this.parseError="function"==typeof _.yy.parseError?_.yy.parseError:_getPrototypeOf2["default"](this).parseError;for(var b,T,k,w,x,j,M,E,O,A={};;){if(k=n[n.length-1],this.defaultActions[k]?w=this.defaultActions[k]:((null===b||"undefined"==typeof b)&&(b=t()),w=s[k]&&s[k][b]),"undefined"==typeof w||!w.length||!w[0]){var C="";O=[];for(j in s[k])this.terminals_[j]&&j>d&&O.push("'"+this.terminals_[j]+"'");C=y.showPosition?"Parse error on line "+(c+1)+":\n"+y.showPosition()+"\nExpecting "+O.join(", ")+", got '"+(this.terminals_[b]||b)+"'":"Parse error on line "+(c+1)+": Unexpected "+(b==h?"end of input":"'"+(this.terminals_[b]||b)+"'"),this.parseError(C,{text:y.match,token:this.terminals_[b]||b,line:y.yylineno,loc:m,expected:O})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+k+", token: "+b);switch(w[0]){case 1:n.push(b),o.push(y.yytext),i.push(y.yylloc),n.push(w[1]),b=null,T?(b=T,T=null):(l=y.yyleng,u=y.yytext,c=y.yylineno,m=y.yylloc,f>0&&f--);break;case 2:if(M=this.productions_[w[1]][1],A.$=o[o.length-M],A._$={first_line:i[i.length-(M||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(M||1)].first_column,last_column:i[i.length-1].last_column},v&&(A._$.range=[i[i.length-(M||1)].range[0],i[i.length-1].range[1]]),x=this.performAction.apply(A,[u,l,c,_.yy,w[1],o,i].concat(p)),"undefined"!=typeof x)return x;M&&(n=n.slice(0,-1*M*2),o=o.slice(0,-1*M),i=i.slice(0,-1*M)),n.push(this.productions_[w[1]][0]),o.push(A.$),i.push(A._$),E=s[n[n.length-2]][n[n.length-1]],n.push(E);break;case 3:return!0}}return!0}},$=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var r,n,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack){for(var o in a)this[o]=a[o];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,r,n;this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),o=0;o<a.length;o++)if(r=this._input.match(this.rules[a[o]]),r&&(!t||r[0].length>t[0].length)){if(t=r,n=o,this.options.backtrack_lexer){if(e=this.test_match(r,a[o]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,a[n]),e!==!1?e:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,r,n){switch(r){case 0:return 31;case 1:return 33;case 2:return"from";case 3:return 24;case 4:return 25;case 5:return 26;case 6:return 27;case 7:return 21;case 8:return 19;case 9:return 22;case 10:return 20;case 11:return 28;case 12:return 29;case 13:return 36;case 14:return 38;case 15:return 57;case 16:return 55;case 17:break;case 18:return 51;case 19:return 50;case 20:return 50;case 21:return 42;case 22:return 53;case 23:return 43;case 24:return 11;case 25:return 12;case 26:return 13;case 27:return 40;case 28:return 8;case 29:return 28;case 30:return 29;case 31:return 25;case 32:return 24;case 33:return 27;case 34:return 26;case 35:return 21;case 36:return 22;case 37:return 20;case 38:return 19;case 39:return 36;case 40:return 38;case 41:return 15;case 42:return 17;case 43:return 48;case 44:return 46;case 45:return 44;case 46:return 49;case 47:return 9;case 48:return 5}},rules:[/^(?:\s+in\b)/,/^(?:\s+notIn\b)/,/^(?:\s+from\b)/,/^(?:\s+(eq|EQ)\b)/,/^(?:\s+(seq|SEQ)\b)/,/^(?:\s+(neq|NEQ)\b)/,/^(?:\s+(sneq|SNEQ)\b)/,/^(?:\s+(lte|LTE)\b)/,/^(?:\s+(lt|LT)\b)/,/^(?:\s+(gte|GTE)\b)/,/^(?:\s+(gt|GT)\b)/,/^(?:\s+(like|LIKE)\b)/,/^(?:\s+(notLike|NOT_LIKE)\b)/,/^(?:\s+(and|AND)\b)/,/^(?:\s+(or|OR)\b)/,/^(?:\s*null\b)/,/^(?:\s*(true|false)\b)/,/^(?:\s+)/,/^(?:-?[0-9]+(?:\.[0-9]+)?\b)/,/^(?:'[^']*')/,/^(?:"[^"]*")/,/^(?:([a-zA-Z_$][0-9a-zA-Z_$]*))/,/^(?:^\/((?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/[imgy]{0,4})(?!\w))/,/^(?:\.)/,/^(?:\*)/,/^(?:\/)/,/^(?:\%)/,/^(?:,)/,/^(?:-)/,/^(?:=~)/,/^(?:!=~)/,/^(?:===)/,/^(?:==)/,/^(?:!==)/,/^(?:!=)/,/^(?:<=)/,/^(?:>=)/,/^(?:>)/,/^(?:<)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\])/,/^(?:\[)/,/^(?:\))/,/^(?:!)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48],inclusive:!0}}};return e}();return N.lexer=$,e.prototype=N,N.Parser=e,new e}();"undefined"!=typeof e&&"undefined"!=typeof r&&(r.parser=a,r.Parser=a.Parser,r.parse=function(){return a.parse.apply(a,arguments)},r.main=function(){},"undefined"!=typeof t&&e.main===t&&r.main(n.argv.slice(1)))}).call(this,e("_process"))},{_process:97}],10:[function(e,t,r){function n(e,t,r){var n=e;e=e.replace(/(\s+)\/\/(.*)/g,"").replace(/\r\n|\r|\n/g," ");var o=[],i=!0,s=!1,u=void 0;try{for(var c,l=_getIterator3["default"](t.keys());!(i=(c=l.next()).done);i=!0){var f=c.value;o.push(f)}}catch(d){s=!0,u=d}finally{try{!i&&l["return"]&&l["return"]()}finally{if(s)throw u}}for(var h=new RegExp("^("+o.join("|")+")"),p=void 0;e&&-1!==(p=a.findNextTokenIndex(e));){e=e.substr(p);var y=e.match(h);if(null===y)throw new Error("Error parsing "+e);var _=y[1];if(!t.has(_))throw new Error("Unknown token"+_);try{e=t.get(_)(e,r).replace(/^\s*|\s*$/g,"")}catch(g){throw new Error("Invalid "+_+" definition \n"+g.message+"; \nstarting at : "+n)}}return r}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./util");r["default"]=n},{"./util":12}],11:[function(require,module,exports){function isWhiteSpace(e){return 0===e.replace(/[\s|\n|\r|\t]/g,"").length}function joinFunc(e,t){return"; "+t}function splitRuleLineByPredicateExpressions(e){var t=e.replace(/,\s*(\$?\w+\s*:)/g,joinFunc),r=t.split(predicateBeginExp).filter(function(e){return""!==e}),n=r.length;if(n){for(var a=[],o=0;n>o;++o){var i=r[o];a.push(-1!==predicates.indexOf(i)?[i,"(",r[++o].replace(/, *$/,"")].join(""):i.replace(/, *$/,""))}return a.join(";")}return t}function parseRules(str){for(var constraints=[],ruleLines=str.split(";"),l=ruleLines.length,ruleLine=void 0,i=0;l>i&&(ruleLine=ruleLines[i].replace(/^\s*|\s*$/g,"").replace(/\n/g,""));i++)if(!isWhiteSpace(ruleLine)){var constraint=[];if(predicateRegExp.test(ruleLine)){var m=ruleLine.match(predicateRegExp),pred=m[1].replace(/^\s*|\s*$/g,"");if(constraint.push(pred),ruleLine=m[2].replace(/^\s*|\s*$/g,""),"or"===pred){constraints.push(constraint.concat(parseRules(splitRuleLineByPredicateExpressions(ruleLine))));continue}}var parts=ruleLine.match(ruleRegExp);if(!parts||!parts.length)throw new Error("Invalid constraint "+ruleLine);constraint.push(parts[2],parts[1]);var _constraints=parts[3].replace(/^\s*|\s*$/g,""),hashParts=_constraints.match(constraintRegExp),frm=null;if(hashParts){var hash=hashParts[1],_constraint=_constraints.replace(hash,"");if(fromRegExp.test(_constraint)){var fromMatch=_constraint.match(fromRegExp);frm=fromMatch[0],_constraint=_constraint.replace(fromMatch[0],"")}_constraint&&constraint.push(_constraint.replace(/^\s*|\s*$/g,"")),hash&&constraint.push(eval("("+hash.replace(/(\$?\w+)\s*:\s*(\$?\w+)/g,'"$1" : "$2"')+")"))}else if(_constraints&&!isWhiteSpace(_constraints)){if(fromRegExp.test(_constraints)){var _fromMatch=_constraints.match(fromRegExp);frm=_fromMatch[0],_constraints=_constraints.replace(_fromMatch[0],"")}constraint.push(_constraints)}frm&&constraint.push(frm),constraints.push(constraint)}return constraints}function salience(e,t){if(salienceRegexp.test(e)){var r=e.match(salienceRegexp),n=parseInt(r[2],10);if(isNaN(n))throw new Error("Invalid salience/priority "+r[2]);return t.options.priority=n,e.replace(r[0],"")}throw new Error("invalid format")}function agendaGroup(e,t){if(agendaGroupRegexp.test(e)){var r=e.match(agendaGroupRegexp),n=r[2];if(!n)throw new Error("Invalid agenda-group "+r[2]);return t.options.agendaGroup=n.replace(/^["']|["']$/g,""),e.replace(r[0],"")}throw new Error("invalid format")}function autoFocus(e,t){if(autoFocusRegexp.test(e)){var r=e.match(autoFocusRegexp),n=r[2];if(!n)throw new Error("Invalid auto-focus "+r[2]);return t.options.autoFocus="true"===n?!0:!1,e.replace(r[0],"")}throw new Error("invalid format")}function when(e,t){var r=e.replace(/^when\s*/,"").replace(/^\s*|\s*$/g,"");if("{"===utils.findNextToken(r)){var n=utils.getTokensBetween(r,"{","}",!0).join("");return r=r.replace(n,""),t.constraints=parseRules(n.replace(/^\{\s*|\}\s*$/g,"")),r}throw new Error("unexpected token : expected : '{' found : '"+utils.findNextToken(r)+"'")}function then(e,t){if(t.action)throw new Error("action already defined for rule"+t.name);var r=e.replace(/^then\s*/,"").replace(/^\s*|\s*$/g,"");if("{"===utils.findNextToken(r)){var n=utils.getTokensBetween(r,"{","}",!0).join("");if(r=r.replace(n,""),t.action||(t.action=n.replace(/^\{\s*|\}\s*$/g,"")),!isWhiteSpace(r))throw new Error("Error parsing then block "+e);return r}throw new Error("unexpected token : expected : '{' found : '"+utils.findNextToken(r)+"'")}function comment(e){return e.match(/^\/\*/)?e.replace(/\/\*.*?\*\//,""):e}function def(e,t){var r=e.replace(/^define\s*/,""),n=r.match(/^([a-zA-Z_$][0-9a-zA-Z_$]*)/);if(n){if(r=r.replace(n[0],"").replace(/^\s*|\s*$/g,""),"{"===utils.findNextToken(r)){var a=utils.getTokensBetween(r,"{","}",!0).join("");return r=r.replace(a,""),t.define.push({name:n[1],properties:"("+a+")"}),r}throw new Error("unexpected token : expected : '{' found : '"+utils.findNextToken(r)+"'")}throw new Error("missing name")}function glbl(e,t){var r=e.replace(/^global\s*/,""),n=r.match(/^([a-zA-Z_$][0-9a-zA-Z_$]*\s*)/);if(n){if(r=r.replace(n[0],"").replace(/^\s*|\s*$/g,""),"="===utils.findNextToken(r)){var a=utils.getTokensBetween(r,"=",";",!0).join(""),o=a.substring(1,a.length-1);return o=o.replace(/^\s+|\s+$/g,""),/^require\(/.test(o)&&(o=""),t.scope.push({name:n[1].replace(/^\s+|\s+$/g,""),body:o}),r=r.replace(a,"")}throw new Error("unexpected token : expected : '=' found : '"+utils.findNextToken(r)+"'")}throw new Error("missing name")}function fun(e,t){var r=e.replace(/^function\s*/,""),n=r.match(/^([a-zA-Z_$][0-9a-zA-Z_$]*)\s*/);if(n){if(r=r.replace(n[0],""),"("===utils.findNextToken(r)){var a=utils.getParamList(r);if(r=r.replace(a,"").replace(/^\s*|\s*$/g,""),"{"===utils.findNextToken(r)){var o=utils.getTokensBetween(r,"{","}",!0).join("");return r=r.replace(o,""),t.scope.push({name:n[1],body:"function"+a+o}),r}throw new Error("unexpected token : expected : '{' found : '"+utils.findNextToken(r)+"'")}throw new Error("unexpected token : expected : '(' found : '"+utils.findNextToken(r)+"'")}throw new Error("missing name")}function rule(e,t){var r=e.replace(/^rule\s*/,""),n=r.match(/^([a-zA-Z_$][0-9a-zA-Z_$]*|"[^"]*"|'[^']*')/);if(n){if(r=r.replace(n[0],"").replace(/^\s*|\s*$/g,""),"{"===utils.findNextToken(r)){var a={name:n[1].replace(/^["']|["']$/g,""),options:{},constraints:null,action:null},o=utils.getTokensBetween(r,"{","}",!0).join("");return r=r.replace(o,""),parse_1["default"](o.replace(/^\{\s*|\}\s*$/g,""),ruleTokens,a),t.rules.push(a),r}throw new Error("unexpected token : expected : '{' found : '"+utils.findNextToken(r)+"'")}throw new Error("missing name")}Object.defineProperty(exports,"__esModule",{value:!0});var utils=require("./util"),parse_1=require("./parse"),predicates=["not","or","exists"],predicateRegExp=new RegExp("^("+predicates.join("|")+") *\\((.*)\\)$","m"),predicateBeginExp=new RegExp(" *("+predicates.join("|")+") *\\(","g"),salienceRegexp=/^(salience|priority)\s*:\s*(-?\d+)\s*[,;]?/,agendaGroupRegexp=/^(agenda-group|agendaGroup)\s*:\s*([a-zA-Z_$][0-9a-zA-Z_$]*|"[^"]*"|'[^']*')\s*[,;]?/,autoFocusRegexp=/^(auto-focus|autoFocus)\s*:\s*(true|false)\s*[,;]?/,ruleRegExp=/^(\$?\w+) *: *(\w+)(.*)/,constraintRegExp=/(\{ *(?:["']?\$?\w+["']?\s*:\s*["']?\$?\w+["']? *(?:, *["']?\$?\w+["']?\s*:\s*["']?\$?\w+["']?)*)+ *\})/,fromRegExp=/(\bfrom\s+.*)/,ruleTokens=new _map2["default"];ruleTokens.set("salience",salience),ruleTokens.set("priority",salience),ruleTokens.set("agendaGroup",agendaGroup),ruleTokens.set("agenda-group",agendaGroup),ruleTokens.set("autoFocus",autoFocus),ruleTokens.set("auto-focus",autoFocus),ruleTokens.set("when",when),ruleTokens.set("then",then);var topLevelTokens=new _map2["default"];topLevelTokens.set("/",comment),topLevelTokens.set("define",def),topLevelTokens.set("global",glbl),topLevelTokens.set("function",fun),topLevelTokens.set("rule",rule),exports["default"]=topLevelTokens},{"./parse":10,"./util":12}],12:[function(e,t,r){function n(e,t,r,n){var a=0,o=[];t||(t=u[r],a=1),r||(r=u[t]),e=Object(e);for(var i=!1,s=void 0,c=0,l=!1;s=e.charAt(c++);)if(s===t)a++,i?o.push(s):(i=!0,n&&o.push(s));else if(s===r&&c){if(a--,0===a){n&&o.push(s),l=!0;break}o.push(s)}else i&&o.push(s);if(!l)throw new Error("Unable to match "+t+" in "+e);return o}function a(e){return n(e,"(",")",!0).join("")}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2];r=r||e.length;var n=-1,a=e.length;for((!r||r>a)&&(r=a);r>t;t++){var o=e.charAt(t);if(!s.test(o)){n=t;break}}return n}function i(e,t,r){return e.charAt(o(e,t,r))}Object.defineProperty(r,"__esModule",{value:!0});var s=/[\s|\n|\r|\t]/,u={"{":"}","}":"{","(":")",")":"(","[":"]"};r.getTokensBetween=n,r.getParamList=a,r.findNextTokenIndex=o,r.findNextToken=i},{}],13:[function(e,t,r){function n(e){return delete e.class_type,delete e.pattern,e}function a(e){return e=n(e),e.from=i["default"](e.from),e}function o(e){var t=u.get(e.tp);return t(e)}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./constraint"),s=e("../pattern"),u=new _map2["default"];u.set(s.patternType.object,n),u.set(s.patternType.initial_fact,n),u.set(s.patternType.not,n),u.set(s.patternType.exists,n),u.set(s.patternType.from,a),u.set(s.patternType.from_exists,a),u.set(s.patternType.from_not,a),r["default"]=o},{"../pattern":51,"./constraint":5}],14:[function(e,t,r){function n(e,t,r,n){var a=null,i=!1;return t.agendaGroup&&(a=t.agendaGroup,i=o["default"](t.autoFocus)?t.autoFocus:!1),{n:e,pt:r,action:n,p:t.priority||t.salience||0,g:a,af:i}}function a(e,t,r,a,o){var u=r.every(function(e){return i["default"](e)});u&&1===r.length&&(r=r[0],u=!1);var c=[],l=t.scope||new _map2["default"];if(r.scope=l,u){var f=function(e,t){if(i["default"](e)){if(1!==e.length)throw new Error("invalid pattern structure");e=e[0],t=0}d[t]?d.forEach(function(t){t.push(e)}):(d[t]=0===t?[]:d[t-1].slice(),0!==t&&d[t].pop(),d[t].push(e))},d=[];r.forEach(function(e){e.scope=l,s["default"](e,a).forEach(f)}),c=d.map(function(r){var a=r.filter(function(e,t){return t>0}).reduce(function(e,t){return s.composite_pattern(e,t)},r[0]);return n(e,t,a,o)})}else c=s["default"](r,a).map(function(r){return n(e,t,r,o)});return c}Object.defineProperty(r,"__esModule",{value:!0});var o=e("lodash-ts/isBoolean"),i=e("lodash-ts/isArray"),s=e("../pattern");r.createRule=a},{"../pattern":51,"lodash-ts/isArray":75,"lodash-ts/isBoolean":78}],15:[function(e,t,r){function n(e,t){return e.rule.p-t.rule.p}function a(e,t){for(var r=0,n=e.match.recency,a=t.match.recency,o=n.length-1,i=a.length-1;n[r]===a[r]&&o>r&&i>r&&r++;);var s=n[r]-a[r];return s||(s=o-i),s}function o(e,t){var r=-a(e,t);return 0===r?1:r}function i(e,t){return e.recency-t.recency}function s(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=t.length;return function(e,r){var a=-1,o=0,i=e===r||e.name===r.name&&e.hashCode===r.hashCode;if(!i){for(;++a<n&&!o;)o=t[a](e,r);o=o>0?1:-1}return o}}Object.defineProperty(r,"__esModule",{value:!0});r["default"]=s(n,i,o)},{}],16:[function(e,t,r){function n(e){var t=e.map(function(e){return W["default"](e)?W["default"](e[0])?n(e):e.reverse().join("."):e});return U["default"](t).filter(function(e){return!!e})}function a(e){var t=[],r=e[2];if("identifier"===r)return[e[0]];if("function"===r)t=t.concat(a(e[0])).concat(a(e[1]));else if("string"!==r&&"number"!==r&&"boolean"!==r&&"regexp"!==r&&"unary"!==r&&"unary"!==r)if("prop"===r){if(t=t.concat(a(e[0])),e[1])for(var n=e[1];W["default"](n);){if("function"===n[2]){t=t.concat(a(n[1]));break}n=n[1]}}else e[0]&&(t=t.concat(a(e[0]))),e[1]&&(t=t.concat(a(e[1])));return X.removeDups(t)}function o(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:!1,o=arguments[4],i=B(e);t=t||new _map2["default"];var s=a(e),u=s.filter(function(e){return t.has(e)}).map(function(e){return"var "+e+"=scope.get('"+e+"');"}),c=s.filter(function(e){return!t.has(e)}).map(function(e){return n||e!==r?"var "+e+"=fact.get('"+e+"');":e===r?"var "+e+"=hash.get('"+e+"');":""}),l=u.join("")+"return function"+(n?"(fact){":"(fact, hash){")+c.join("")+" return "+(o?o(i):i)+";}";return new Function("scope",l)(t)}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1;return o(e,t.scope,t.alias,r,function(e){return"!!("+e+")"})}function s(e){var t=[];if(e){var r=e[2];if(!r)return t;"prop"!==r&&"identifier"!==r&&"string"!==r&&"number"!==r&&"boolean"!==r&&"regexp"!==r&&"unary"!==r&&"unary"!==r?(t[0]=s(e[0]),t[1]=s(e[1])):t="identifier"===r?[e[0]]:s(e[1]).concat(s(e[0]))}return t}function u(e){return"composite"===e[2]?u(e[0]):/^(\w+(\['[^']*'])*) *([!=]==?|[<>]=?) (\w+(\['[^']*'])*)$/.test(B(e))?U["default"](n(s(e))):[]}function c(e){return B(e)}function l(e,t){return["(",B(e),"&&",B(t),")"].join(" ")}function f(e,t){return["(",B(e),"||",B(t),")"].join(" ")}function d(e){return-1*B(e)}function h(e,t){return[B(e),"+",B(t)].join(" ")}function p(e,t){return[B(e),"-",B(t)].join(" ")}function y(e,t){return[B(e),"*",B(t)].join(" ")}function _(e,t){return[B(e),"/",B(t)].join(" ")}function g(e,t){return[B(e),"%",B(t)].join(" ")}function m(e,t){return[B(e),"<",B(t)].join(" ")}function v(e,t){return[B(e),">",B(t)].join(" ")}function b(e,t){return[B(e),"<=",B(t)].join(" ")}function T(e,t){return[B(e),">=",B(t)].join(" ")}function k(e,t){return[B(t),".test(",B(e),")"].join("")}function w(e,t){return["!",B(t),".test(",B(e),")"].join("")}function x(e,t){return[B(e),"==",B(t)].join(" ")}function j(e,t){return[B(e),"===",B(t)].join(" ")}function M(e,t){return[B(e),"!=",B(t)].join(" ")}function E(e,t){return[B(e),"!==",B(t)].join(" ")}function O(e,t){return["(indexOf(",B(t),",",B(e),")) != -1"].join("")}function A(e,t){return["(indexOf(",B(t),",",B(e),")) == -1"].join("")}function C(e,t){var r=[];return e&&r.push(B(e)),t&&r.push(B(t)),r.join(",")}function q(e){var t=[];if(e){var r=B(e);return W["default"](r)?r:["[",r,"]"].join("")}return["[",t.join(","),"]"].join("")}function L(e,t){var r=B(t);return[B(e),"(",r,")"].join("")}function P(e){return"'"+e+"'"}function I(e){return e}function S(e){return e}function R(e){return e}function F(e){return e}function N(){return"null"}function $(e){return["!(",B(e),")"].join("")}function D(e,t){return"function"===t[2]?[B(e),B(t)].join("."):[B(e),"['",B(t),"']"].join("")}function H(e,t){return"function"===t[2]?[B(e),B(t)].join("."):[B(e),"[",B(t),"]"].join("")}function B(e){var t=e[2],r=e[0],n=e[1];switch(t){case"composite":return c(r);case"and":return l(r,n);case"or":return f(r,n);case"prop":return D(r,n);case"propLookup":return H(r,n);case"unary":return d(r);case"plus":return h(r,n);case"minus":return p(r,n);case"mult":return y(r,n);case"div":return _(r,n);case"mod":return g(r,n);case"lt":return m(r,n);case"gt":return v(r,n);case"lte":return b(r,n);case"gte":return T(r,n);case"like":return k(r,n);case"notLike":return w(r,n);case"eq":return x(r,n);case"seq":return j(r,n);case"neq":return M(r,n);case"sneq":return E(r,n);case"in":return O(r,n);case"notIn":return A(r,n);case"arguments":return C(r,n);case"array":return q(r);case"function":return L(r,n);case"string":return P(r);case"number":return I(r);case"boolean":return S(r);case"regexp":return R(r);case"identifier":return F(r);case"null":return N();case"logicalNot":return $(r);default:throw new Error("can not find method."+t)}}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];return o(e,t.scope,t.alias,r,function(e){return e})}Object.defineProperty(r,"__esModule",{value:!0});var U=e("lodash-ts/flattenDeep"),W=e("lodash-ts/isArray"),X=e("./lang");r.getIdentifiers=a,r.getMatcher=i,r.getIndexableProperties=u,r.getSourceMatcher=G},{"./lang":25,"lodash-ts/flattenDeep":72,"lodash-ts/isArray":75}],17:[function(e,t,r){function n(e){return{tp:w["true"],a:e,assert:function(){return!0},equal:function(t){return t.tp==w["true"]&&e===t.a}}}function a(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=M.getMatcher(r,n,!0);return{options:n,tp:e,a:t,constraint:r,assert:function(e,t){return a(e,t)},equal:function(e){return e.a==t,x["default"](r,e.constraint)}}}function o(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(w.equality,e,t,r)}function i(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(w.inequality,e,t,r)}function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(w.comparison,e,t,r)}function u(e,t,r){return{tp:w.object,a:e,cls:t,constraint:r,assert:function(e){return e instanceof r||e.constructor===r},equal:function(e){return e.tp===w.object&&r===e.constraint}}}function c(e,t){return{tp:w.hash,a:e,constraint:t,assert:function(){return!0},equal:function(r){return r.tp===w.hash&&r.a===e&&x["default"](t,r.constraint)}}}function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=M.getSourceMatcher(t,r,!0);return{tp:w.from,options:r,condition:t,a:e,constraint:n,assert:function(e,t){return n(e,t)},equal:function(r){return r.tp===w.from&&r.a===e&&x["default"](t,r.constraint)}}}function f(e){return e.tp===w.equality||e.tp===w.inequality||e.tp===w.comparison}function d(e){return e.tp===w.hash}function h(e){return e.tp===w.reference||e.tp===w.reference_equality||e.tp===w.reference_gt||e.tp===w.reference_gte||e.tp===w.reference_inequality||e.tp===w.reference_lt||e.tp===w.reference_lte}function p(e){return e.tp===w.reference_equality||e.tp===w.reference_gt||e.tp===w.reference_gte||e.tp===w.reference_inequality||e.tp===w.reference_lt||e.tp===w.reference_lte}function y(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=M.getMatcher(n,a,!1);return{options:a,op:t,tp:e,a:r,constraint:n,vars:M.getIdentifiers(n).filter(function(e){return e!==r}),assert:function(e,t){return o(e,t)},getIndexableProperties:function(){return M.getIndexableProperties(n)},merge:function(o){return h(o)?y(e,t,r||o.a,[n,o.constraint,"and"],j["default"]({},a)):y(e,t,r,n,a)},equal:function(e){return h(e)&&x["default"](n,e.constraint)}}}function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference,"none",e,t,r)}function g(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference_equality,"eq",e,t,r)}function m(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference_inequality,"neq",e,t,r)}function v(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference_gt,"gt",e,t,r)}function b(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference_gte,"gte",e,t,r)}function T(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference_lt,"lt",e,t,r)}function k(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(w.reference_lte,"lte",e,t,r)}Object.defineProperty(r,"__esModule",{value:!0});var w,x=e("lodash-ts/isEqual"),j=e("lodash-ts/mixin"),M=e("./constraint-matcher");!function(e){e[e.comparison=0]="comparison",e[e.equality=1]="equality",e[e.from=2]="from",e[e.hash=3]="hash",e[e.inequality=4]="inequality",e[e.object=5]="object",e[e.reference=6]="reference",e[e.reference_equality=7]="reference_equality",e[e.reference_gt=8]="reference_gt",e[e.reference_gte=9]="reference_gte",e[e.reference_inequality=10]="reference_inequality",e[e.reference_lt=11]="reference_lt",e[e.reference_lte=12]="reference_lte",e[e["true"]=13]="true"}(w=r.constraintType||(r.constraintType={})),r.create_true_constraint=n,r.create_equality_constraint=o,r.create_inequality_constraint=i,r.create_comparison_constraint=s,r.create_object_constraint=u,r.create_hash_constraint=c,r.create_from_constraint=l;var E;!function(e){e[e.none=0]="none",e[e.eq=1]="eq",e[e.gt=2]="gt",e[e.gte=3]="gte",e[e.neq=4]="neq",e[e.lt=5]="lt",e[e.lte=6]="lte"}(E||(E={})),r.is_instance_of_equality=f,r.is_instance_of_hash=d,r.is_instance_of_reference_constraint=h,r.is_instance_of_reference_eq_constraint=p,r.create_reference_constraint=_,r.create_reference_equality_constraint=g,r.create_reference_inequality_constraint=m,r.create_reference_gt_constraint=v,r.create_reference_gte_constraint=b,r.create_reference_lt_constraint=T,r.create_reference_lte_constraint=k},{"./constraint-matcher":16,"lodash-ts/isEqual":81,"lodash-ts/mixin":95}],18:[function(e,t,r){function n(e,t){return e.map(function(e){return e.id}).reduce(function(e,t){return""+e+t+":"},"")+t}function a(e,t,r){r.forEach(function(r){e.set(r,t.get(r))})}function o(e,t,r){e.push.apply(e,_toConsumableArray3["default"](t)),r.forEach(function(t){-1===e.indexOf(t)&&e.push(t)})}Object.defineProperty(r,"__esModule",{value:!0});var i=e("lodash-ts/isBoolean"),s=function(){function e(){_classCallCheck3["default"](this,e),this.isMatch=!0,this.hashCode="",this.facts=[],this.factIds=[],this.factHash=new _map2["default"],this.recency=[],this.aliases=[]}return _createClass3["default"](e,[{key:"addFact",value:function(e){return this.facts.push(e),this.recency.push(e.recency),this.factIds.push(e.id),this.hashCode=this.factIds.join(":"),this}},{key:"merge",value:function(t){var r,n,i,s,u=new e;return u.isMatch=t.isMatch,(r=u.facts).push.apply(r,_toConsumableArray3["default"](this.facts)),(n=u.facts).push.apply(n,_toConsumableArray3["default"](t.facts)),(i=u.aliases).push.apply(i,_toConsumableArray3["default"](this.aliases)),(s=u.aliases).push.apply(s,_toConsumableArray3["default"](t.aliases)),u.hashCode=this.hashCode+":"+t.hashCode,a(u.factHash,this.factHash,this.aliases),a(u.factHash,t.factHash,t.aliases),o(u.recency,this.recency,t.recency),u}}]),e}();r.Match=s;var u=function(){function e(t,r,a){_classCallCheck3["default"](this,e),this.match=null,this.factHash=null,this.aliases=null,this.fact=null,this.hashCode=null,this.paths=null,this.pathsHash=null,this.fromMatches={},this.blocked=!1,this.fact=t,this.match=a?a:(new s).addFact(t),this.factHash=this.match.factHash,this.aliases=this.match.aliases,this.hashCode=this.match.hashCode,r?(this.paths=r,this.pathsHash=n(r,this.hashCode)):this.pathsHash=this.hashCode}return _createClass3["default"](e,[{key:"set",value:function(e,t){return this.factHash.set(e,t),this.aliases.push(e),this}},{key:"isMatch",value:function(e){return i["default"](e)?(this.match.isMatch=e,this):this.match.isMatch}},{key:"mergeMatch",value:function(e){var t=this.match=this.match.merge(e);return this.factHash=t.factHash,this.hashCode=t.hashCode,this.aliases=t.aliases,this}},{key:"clone",value:function(t,r,n){return new e(t||this.fact,r,n||this.match)}}]),e}();r["default"]=u},{"lodash-ts/isBoolean":78}],19:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;_classCallCheck3["default"](this,e),this.looping=!1,this.matchUntilHalt=!1,this.__halted=!1,this.flowAltered=!1,this.flow=t,this.agenda=t.agenda,this.rootNode=t.data,this.matchUntilHalt=!!n,this.onAlter=function(){r.flowAltered=!0}}return _createClass3["default"](e,[{key:"halt",value:function(){this.__halted=!0,this.looping||this.tearDown()}},{key:"setup",value:function(){var e=this.flow;this.rootNode.bucket.counter=0,e.on("assert",this.onAlter),e.on("modify",this.onAlter),e.on("retract",this.onAlter)}},{key:"tearDown",value:function(){var e=this.flow;e.removeListener("assert",this.onAlter),e.removeListener("modify",this.onAlter),
e.removeListener("retract",this.onAlter)}},{key:"__handleAsyncNext",value:function(e){var t=this,r=this.agenda;return e.then(function(){return t.looping=!1,r.isEmpty()?!t.matchUntilHalt||t.__halted?t.tearDown():new _promise2["default"](function(e,t){t("something must be wrong.")}):(t.flowAltered&&(++t.rootNode.bucket.counter,t.flowAltered=!1),t.__halted?t.tearDown():t.callNext())})}},{key:"callNext",value:function(){this.looping=!0;var e=this.agenda.fireNext();return this.__handleAsyncNext(e)}},{key:"execute",value:function(){var e=this;return new _promise2["default"](function(t){e.setup(),t(e.callNext())})}}]),e}();r["default"]=n},{}],20:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=0,a=function(){function e(t){_classCallCheck3["default"](this,e),this.recency=0,this.id=n++,this.object=t}return _createClass3["default"](e,[{key:"equals",value:function(e){return e===this.object}},{key:"hashCode",value:function(){return this.id}}]),e}();r["default"]=a},{}],21:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./fact"),a=function(e){function t(){return _classCallCheck3["default"](this,t),_possibleConstructorReturn3["default"](this,(t.__proto__||_getPrototypeOf2["default"](t)).apply(this,arguments))}return _inherits3["default"](t,e),t}(n["default"]);r["default"]=a},{"./fact":20}],22:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./conflict"),a=e("./flow"),o=e("./facts/initial"),i=function(){function e(t,r,a){_classCallCheck3["default"](this,e),this.__defined=new _map2["default"],this.defined=r,this.scope=a,this.root=t,this.conflictResolutionStrategy=n["default"]}return _createClass3["default"](e,[{key:"getDefined",value:function(e){var t=this.__defined.get(e);if(!t)throw new Error(e+" flow class is not defined");return t}},{key:"addDefined",value:function(e,t){return this.__defined.set(e,t),t}},{key:"getSession",value:function(){var e=new a["default"](this.root,this.conflictResolutionStrategy,this.defined,this.scope);e.assert(new o["default"]);for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return r.forEach(function(t){e.assert(t)}),e}}]),e}();r["default"]=i},{"./conflict":15,"./facts/initial":21,"./flow":23}],23:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./working-memory"),a=e("./agenda"),o=e("./EventEmitter"),i=e("./nodes/root-node"),s=e("./execution-strategy"),u=e("./runtime/nodes"),c=function(e){function t(e,r,o,i){_classCallCheck3["default"](this,t);var s=_possibleConstructorReturn3["default"](this,(t.__proto__||_getPrototypeOf2["default"](t)).call(this));return s.workingMemory=new n["default"],s.agenda=new a["default"](s,r),s.agenda.on("fire",function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];s.emit.apply(s,["fire"].concat(t))}),s.agenda.on("focused",function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];s.emit.apply(s,["focused"].concat(t))}),s.data=u["default"](e,s.agenda,o,i),s}return _inherits3["default"](t,e),_createClass3["default"](t,[{key:"getFacts",value:function(e){return e?this.workingMemory.getFactsByType(e):this.workingMemory.getFacts()}},{key:"getFact",value:function(e){var t=this.getFacts(e);return t&&t[0]}},{key:"focus",value:function(e){return this.agenda.setFocus(e),this}},{key:"halt",value:function(){return this.executionStrategy.halt(),this}},{key:"dispose",value:function(){this.workingMemory.dispose(),this.agenda.dispose(),i.dispose(this.data)}},{key:"assert",value:function(e){return i.assertFact(this.data,this.workingMemory.assertFact(e),this.workingMemory),this.emit("assert",e),e}},{key:"retract",value:function(e){return i.retractFact(this.data,this.workingMemory.retractFact(e),this.workingMemory),this.emit("retract",e),e}},{key:"modify",value:function(e){return i.modifyFact(this.data,this.workingMemory.modifyFact(e),this.workingMemory),this.emit("modify",e),e}},{key:"containsRule",value:function(e){return i.containsRule(this.data,e)}},{key:"matchUntilHalt",value:function(){return this.executionStrategy=new s["default"](this,!0),this.executionStrategy.execute()}},{key:"match",value:function(){return this.executionStrategy=new s["default"](this),this.executionStrategy.execute()}}]),t}(o["default"]);r["default"]=c},{"./EventEmitter":1,"./agenda":2,"./execution-strategy":19,"./nodes/root-node":48,"./runtime/nodes":54,"./working-memory":57}],24:[function(e,t,r){function n(e,t){var r=a["default"](e,t);return o["default"](r,t)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./compile/index"),o=e("./runtime/compile");r.compile=n,r["default"]=n},{"./compile/index":6,"./runtime/compile":52}],25:[function(e,t,r){function n(e){var t=e.match(/(\w+)\(\)$/);return t?(e=t[1],function(t){return t[e]()}):function(t){return s["default"](t)||c["default"](t)?t.get(e):t[e]}}function a(e){var t=e.split(".");if(1===t.length)return n(t[0]);var r=t.map(function(e){return n(e)}),a=r.length;return function(e){for(var t=-1,n=e;++t<a;)n=r[t](n);return n}}function o(e){return e.filter(function(t,r){return-1==e.indexOf(t,++r)})}function i(e){if(s["default"](e))return e;if(u["default"](e)){var t=new _map2["default"];for(var r in e)e.hasOwnProperty(r)&&(t.set(r,e[r]),t[r]=e[r]);return t}return new _map2["default"]}Object.defineProperty(r,"__esModule",{value:!0});var s=e("lodash-ts/isMap"),u=e("lodash-ts/isObject"),c=e("lodash-ts/isWeakMap");r.plucker=a,r.removeDups=o,r.to_map=i},{"lodash-ts/isMap":85,"lodash-ts/isObject":87,"lodash-ts/isWeakMap":92}],26:[function(e,t,r){function n(e){return{data:e,balance:0,left:null,right:null}}function a(e,t,r){var n=e[r];return e[r]=n[t],n[t]=e,n}function o(e,t,r){return e[r]=a(e[r],r,t),a(e,t,r)}function i(e,t,r){var n="left"===t?"right":"left",a=e[t],o=a[n];0===o.balance?e.balance=a.balance=0:o.balance===r?(e.balance=-r,a.balance=0):(e.balance=0,a.balance=r),o.balance=0}function s(e,t){var r="left"===t?"right":"left",n=e[t],s="right"===t?-1:1;return n.balance===s?(e.balance=n.balance=0,e=a(e,r,t)):(i(e,t,s),e=o(e,r,t)),e}function u(e,t,r){var n="left"===t?"right":"left",s=e[n],u="right"===t?-1:1;return s.balance===-u?(e.balance=s.balance=0,e=a(e,t,n)):s.balance===u?(i(e,n,-u),e=o(e,t,n)):(e.balance=-u,s.balance=u,e=a(e,t,n),r.done=!0),e}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./tree"),l=Math.abs,f=function(e){function t(){return _classCallCheck3["default"](this,t),_possibleConstructorReturn3["default"](this,(t.__proto__||_getPrototypeOf2["default"](t)).apply(this,arguments))}return _inherits3["default"](t,e),_createClass3["default"](t,[{key:"insert",value:function(e){var t=this,r=this.compare,a=t.__root;if(null===a||void 0===a)t.__root=n(e);else{for(var o=[],i=[],u=a,c=0,f=void 0;;){if(f=o[c]=-1===r(e,u.data)?"left":"right",i[c++]=u,!u[f]){u[f]=n(e);break}u=u[f]}if(!u[f])return null;for(;--c>=0&&(i[c].balance+="right"===o[c]?-1:1,0!==i[c].balance);)if(l(i[c].balance)>1){i[c]=s(i[c],o[c]),0!==c?i[c-1][o[c-1]]=i[c]:t.__root=i[0];break}}}},{key:"remove",value:function(e){var t=this,r=this.compare,n=t.__root;if(null!==n&&void 0!==n){for(var a=[],o=[],i={done:!1},s=n,c=0,f=void 0,d=void 0;;){if(!s)return;if(0===(d=r(e,s.data)))break;f=o[c]=-1===d?"left":"right",a[c++]=s,s=s[f]}var h=s.left,p=s.right;if(h&&p){var y=h;for(o[c]="left",a[c++]=s;y.right;)o[c]="right",a[c++]=y,y=y.right;s.data=y.data,a[c-1][a[c-1]===s?"left":"right"]=y.left}else f=h?"left":"right",0!==c?a[c-1][o[c-1]]=s[f]:t.__root=s[f];for(;--c>=0&&!i.done;){a[c].balance+="left"===o[c]?-1:1;var _=l(a[c].balance);if(1===_)break;_>1&&(a[c]=u(a[c],o[c],i),0!==c?a[c-1][o[c-1]]=a[c]:t.__root=a[0])}}}},{key:"__printNode",value:function(e,t){var r=[];e?(this.__printNode(e.right,t+1),r.push("	".repeat(t)),r.push(e.data+":"+e.balance+"\n"),console.log(r.join("")),this.__printNode(e.left,t+1)):(r.push("	".repeat(t)),r.push("~"),console.log(r.join("")))}}]),t}(c["default"]);r["default"]=f},{"./tree":27}],27:[function(e,t,r){function n(e,t){var r=0;return e>t?1:t>e?-1:t?r:1}function a(e){return void 0===e||null===e}Object.defineProperty(r,"__esModule",{value:!0});var o="pre_order",i="in_order",s="post_order",u="reverse_order",c=function(){function e(t){_classCallCheck3["default"](this,e),this.__root=null,this.compare=n,t&&(this.compare=t)}return _createClass3["default"](e,[{key:"get_root",value:function(){return this.__root}},{key:"set_root",value:function(e){this.__root=e}},{key:"insert",value:function(){throw new Error("Not Implemented")}},{key:"remove",value:function(){throw new Error("Not Implemented")}},{key:"clear",value:function(){this.__root=null}},{key:"isEmpty",value:function(){return!this.__root}},{key:"print",value:function(){this.__printNode(this.__root,0)}},{key:"__printNode",value:function(e,t){var r=[];a(e)?(r.push("	".repeat(t)),r.push("~"),console.log(r.join(""))):(this.__printNode(e.right,t+1),r.push("	".repeat(t)),r.push(e.data+"\n"),console.log(r.join("")),this.__printNode(e.left,t+1))}},{key:"forEach",value:function(e,t){var r=this;if("function"!=typeof e)throw new TypeError;t=t||i,this.traverse(this.__root,t,function(t){e(t,r)})}},{key:"traverse",value:function(e,t,r){e&&(t=t||o,t===o?(r(e.data),this.traverse(e.left,t,r),this.traverse(e.right,t,r)):t===i?(this.traverse(e.left,t,r),r(e.data),this.traverse(e.right,t,r)):t===s?(this.traverse(e.left,t,r),this.traverse(e.right,t,r),r(e.data)):t===u&&(this.traverse(e.right,t,r),r(e.data),this.traverse(e.left,t,r)))}},{key:"traverseWithCondition",value:function(e,t,r){var n=!0;return e&&(t=t||o,t===o?(n=r(e.data),n&&(n=this.traverseWithCondition(e.left,t,r),n&&(n=this.traverseWithCondition(e.right,t,r)))):t===i?(n=this.traverseWithCondition(e.left,t,r),n&&(n=r(e.data),n&&(n=this.traverseWithCondition(e.right,t,r)))):t===s?(n=this.traverseWithCondition(e.left,t,r),n&&(n&&(n=this.traverseWithCondition(e.right,t,r)),n&&(n=r(e.data)))):t===u&&(n=this.traverseWithCondition(e.right,t,r),n&&(n=r(e.data),n&&(n=this.traverseWithCondition(e.left,t,r))))),n}},{key:"map",value:function(t,r){var n=this;if("function"!=typeof t)throw new TypeError;r=r||i;var a=new e;return this.traverse(this.__root,r,function(e){a.insert(t(e,n))}),a}},{key:"filter",value:function(t,r){var n=this;if("function"!=typeof t)throw new TypeError;r=r||i;var a=new e;return this.traverse(this.__root,r,function(e){t(e,n)&&a.insert(e)}),a}},{key:"some",value:function(e,t){var r=this;if("function"!=typeof e)throw new TypeError;t=t||i;var n=!1;return this.traverseWithCondition(this.__root,t,function(t){return n=e(t,r),!n}),n}},{key:"every",value:function(e,t){var r=this;if("function"!=typeof e)throw new TypeError;t=t||i;var n=!1;return this.traverseWithCondition(this.__root,t,function(t){return n=e(t,r)}),n}},{key:"toArray",value:function(e){e=e||i;var t=[];return this.traverse(this.__root,e,function(e){t.push(e)}),t}},{key:"reduce",value:function(e,t,r){var n=this.toArray(r);return n.reduce(e,t)}},{key:"reduceRight",value:function(e,t,r){var n=this.toArray(r);return n.reduceRight(e,t)}},{key:"contains",value:function(e){for(var t=!1,r=this.__root;null!==r;){var n=this.compare(e,r.data);n?r=-1===n?r.left:r.right:(t=!0,r=null)}return t}},{key:"find",value:function(e){for(var t=void 0,r=this.__root;r;){var n=this.compare(e,r.data);if(!n){t=r.data;break}r=-1===n?r.left:r.right}return t}},{key:"findLessThan",value:function(e,t){var r=[],n=this.compare;return this.traverseWithCondition(this.__root,i,function(a){var o=n(e,a);return!t&&0===o||1===o?(r.push(a),!0):!1}),r}},{key:"findGreaterThan",value:function(e,t){var r=[],n=this.compare;return this.traverse(this.__root,u,function(a){var o=n(e,a);return!t&&0===o||-1===o?(r.push(a),!0):!1}),r}}]),e}();r["default"]=c},{}],28:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){_classCallCheck3["default"](this,e),this.head=null,this.tail=null,this.length=0}return _createClass3["default"](e,[{key:"push",value:function(e){var t=this.tail,r=this.head,n={data:e,prev:t,next:null};return t&&(this.tail.next=n),this.tail=n,r||(this.head=n),this.length++,n}},{key:"remove",value:function(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this.length--}},{key:"forEach",value:function(e){for(var t={next:this.head};t=t.next;)e(t.data)}},{key:"toArray",value:function(){for(var e={next:this.head},t=[];e=e.next;)t.push(e.data);return t}},{key:"removeByData",value:function(e){for(var t={next:this.head};t=t.next;)if(t.data===e){this.remove(t);break}}},{key:"getByData",value:function(e){for(var t={next:this.head};t=t.next;)if(t.data===e)return t}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}}]),e}();r["default"]=n},{}],29:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n;!function(e){e[e.not=0]="not",e[e.exists=1]="exists",e[e.join=2]="join",e[e.from=3]="from",e[e.from_not=4]="from_not",e[e.exists_from=5]="exists_from",e[e.beta=6]="beta",e[e.leftadapter=7]="leftadapter",e[e.rightadapter=8]="rightadapter",e[e.type=9]="type",e[e.alias=10]="alias",e[e.equality=11]="equality",e[e.property=12]="property",e[e.terminal=13]="terminal",e[e.join_reference=14]="join_reference"}(n=r.nodeType||(r.nodeType={}))},{}],30:[function(e,t,r){function n(e,t,r,n){var a=e[t];return i.propagate_assert(e,t,r.set(a.alias,r.fact.object),n)}function a(e,t,r,n){var a=e[t];return i.propagate_modify(e,t,r.set(a.alias,r.fact.object),n)}function o(e,t,r,n){var a=e[t];return i.propagate_retract(e,t,r.set(a.alias,r.fact.object),n)}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./node");r.assert=n,r.modify=a,r.retract=o},{"./node":44}],31:[function(e,t,r){function n(e,t){var r=e[t];r.leftMemory={},r.rightMemory={},j.memory_clear(r.leftTuples),j.memory_clear(r.rightTuples)}function a(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}x.base_assert(e,d,r,n)}}catch(h){i=!0,s=h}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function o(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}x.base_modify(e,d,r,n)}}catch(h){i=!0,s=h}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function i(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}x.base_retract(e,d,r,n)}}catch(h){i=!0,s=h}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function s(e,t,r){var n=e[t],a=r.hashCode,o=n.leftMemory;return a in o?!1:(o[a]=j.memory_push(n.leftTuples,r),r.rightMatches={},!0)}function u(e,t,r,n,a){var o=e[t],i=r.hashCode,s=o.rightMemory[i],u=n.hashCode;if(s){var c=s.data;if(u in c.leftMatches)throw new Error("Duplicate left fact entry");c.leftMatches[u]=a}var l=o.leftMemory[u];if(l){var f=l.data;if(i in f.rightMatches)throw new Error("Duplicate right fact entry");f.rightMatches[i]=a}return a}function c(e,t,r,n,o){a(e,t,u(e,t,n,r,r.clone(null,null,r.match.merge(n.match))),o)}function l(e,t,r,n){s(e,t,r);var a=e[t],o=j.memory_get(a.rightTuples,r);o.forEach(function(a){c(e,t,r,a.data,n)})}function f(e,t,r){var n=e[t],a=r.hashCode,o=n.rightMemory;return a in o?!1:(o[a]=j.memory_push(n.rightTuples,r),r.leftMatches={},!0)}function d(e,t,r,n,o){a(e,t,u(e,t,r,n,n.clone(null,null,n.match.merge(r.match))),o)}function h(e,t,r,n){f(e,t,r);var a=e[t],o=j.memory_get(a.leftTuples,r);o.forEach(function(a){d(e,t,r,a.data,n)})}function p(e,t,r){var n=e[t],a=r.hashCode,o=n.leftMemory[a]||null;if(o){var i=n.rightMemory,s=o.data.rightMatches;j.memory_remove(n.leftTuples,o);var u=_keys4["default"](s);u.forEach(function(e){delete i[e].data.leftMatches[a]}),delete n.leftMemory[a]}return o}function y(e,t,r,n){var a=r.rightMatches,o=_keys4["default"](a);o.forEach(function(r){i(e,t,a[r].clone(),n)})}function _(e,t,r,n,a,i){var s=a.hashCode;s in n?o(e,t,u(e,t,a,r,r.clone(null,null,r.match.merge(a.match))),i):c(e,t,r,a,i)}function g(e,t,r,n){var a=p(e,t,r).data;s(e,t,r);var o=e[t],i=j.memory_get(o.rightTuples,r);if(i.length){var u=a.rightMatches;i.forEach(function(a){_(e,t,r,u,a.data,n)})}else y(e,t,a,n)}function m(e,t,r){var n=e[t],a=r.hashCode,o=n.rightMemory[a]||null,i=n.rightTuples;if(o){var s=n.leftMemory,u=o.data,c=u.leftMatches;j.memory_remove(i,o);var l=_keys4["default"](c);l.forEach(function(e){delete s[e].data.rightMatches[a]}),delete n.rightMemory[a]}return o}function v(e,t,r,n){var a=r.leftMatches,o=_keys4["default"](a);o.forEach(function(r){i(e,t,a[r].clone(),n)})}function b(e,t,r,n,a,i){var s=a.hashCode;s in n?o(e,t,u(e,t,r,a,r.clone(null,null,a.match.merge(r.match))),i):d(e,t,r,a,i)}function T(e,t,r,n){var a=m(e,t,r).data;f(e,t,r);var o=e[t],i=j.memory_get(o.leftTuples,r);if(i.length){var s=a.leftMatches;i.forEach(function(a){b(e,t,r,s,a.data,n)})}else v(e,t,a,n)}function k(e,t,r,n){r=p(e,t,r).data;var a=r.rightMatches,o=_keys4["default"](a);o.forEach(function(r){i(e,t,a[r].clone(),n)})}function w(e,t,r,n){r=m(e,t,r).data;var a=r.leftMatches,o=_keys4["default"](a);o.forEach(function(r){i(e,t,a[r].clone(),n)})}Object.defineProperty(r,"__esModule",{value:!0});var x=e("./node"),j=e("./misc/memory");r.dispose=n,r.assert=a,r.modify=o,r.retract=i,r.__addToLeftMemory=s,r.__addToMemoryMatches=u,r.propagateFromLeft=c,r.assert_left=l,r.__addToRightMemory=f,r.assert_right=h,r.removeFromLeftMemory=p,r.propagateRetractModifyFromLeft=y,r.modify_left=g,r.removeFromRightMemory=m,r.propagateRetractModifyFromRight=v,r.modify_right=T,r.retract_left=k,r.retract_right=w},{"./misc/memory":41,"./node":44}],32:[function(e,t,r){function n(e,t,r,n){var a=e[t],o=a.ca(r.factHash);a.memory.set(r.pathsHash,o),o&&i.propagate_assert(e,t,r,n)}function a(e,t,r,n){var a=e[t],o=r.pathsHash,s=a.memory,u=s.get(o),c=a.ca(r.factHash);a.memory.set(r.pathsHash,c),c?u?i.propagate_modify(e,t,r,n):i.propagate_assert(e,t,r,n):u&&i.propagate_retract(e,t,r,n)}function o(e,t,r,n){var a=e[t],o=r.pathsHash,s=a.memory;s.get(o)&&i.propagate_retract(e,t,r,n),s["delete"](o)}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./node");r.assert=n,r.modify=a,r.retract=o},{"./node":44}],33:[function(e,t,r){function n(e,t,r,n,a){var o=!1;if(e.type_assert(r)){var i=a.getFactHandle(r),s=new l["default"](i,null,null).mergeMatch(t.match).set(e.alias,r);if(n){var u=e.fromMemory[i.id];u||(u=e.fromMemory[i.id]={}),u[t.hashCode]=t}var c=s.factHash,f=e.__equalityConstraints;o=f.length&&f.every(function(e){return e(c)})}return o}function a(e,t,r,a){var o=e[t],i=r.factHash,s=o.from_assert(i),u=!1;return c["default"](s)?(r.blocked=s.some(function(e){return n(o,r,e,!0,a)}),r.blocked&&f.assert(e,t,r.clone(),a)):void 0!==s&&n(o,r,s,!0,a)&&(r.blocked=!0,f.assert(e,t,r.clone(),a)),u}function o(e,t,r,n){f.__addToLeftMemory(e,t,r),a(e,t,r,n)}function i(e,t,r,a,o){var i=e[t],s=a.blocked,u=r.factHash,l=i.from_assert(u);c["default"](l)?r.blocked=l.some(function(e){return n(i,r,e,!0,o)}):void 0!==l&&(r.blocked=n(i,r,l,!0,o));var d=r.blocked;d?s?f.modify(e,t,r.clone(),o):f.assert(e,t,r.clone(),o):s&&f.retract(e,t,r.clone(),o)}function s(e,t,r,n){var a=f.removeFromLeftMemory(e,t,r);if(!a)throw new Error;f.__addToLeftMemory(e,t,r),i(e,t,r,a.data,n);var o=e[t],s=o.fromMemory[r.fact.id];if(o.fromMemory[r.fact.id]={},s)for(var u in s)if(u!==r.hashCode){var c=s[u],l=f.removeFromLeftMemory(e,t,c);if(l){var d=c.clone();d.blocked=!1,f.__addToLeftMemory(e,t,d),i(e,t,d,l.data,n)}}}function u(e,t,r,n){var a=f.removeFromLeftMemory(e,t,r);if(a){var o=a.data;o.blocked&&f.retract(e,t,o.clone(),n)}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("lodash-ts/isArray"),l=e("../context"),f=e("./beta-node");r.assert_left=o,r.modify_left=s,r.retract_left=u},{"../context":18,"./beta-node":31,"lodash-ts/isArray":75}],34:[function(e,t,r){function n(e,t,r,n,a){e[t];r.blocker=n,y.removeFromLeftMemory(e,t,r),_.addToLeftBlockedMemory(e,t,n.blocking.push(r)),y.assert(e,t,_.__cloneContext(e,t,r),a)}function a(e,t,r,n,a){y.__addToLeftMemory(e,t,r),n&&y.retract(e,t,_.__cloneContext(e,t,r),a)}function o(e,t,r,n){a(e,t,r,!1,n)}function i(e,t,r,a,o){n(e,t,r,a,o)}function s(e,t,r,n){var a=e[t],s=g.memory_get(a.rightTuples,r),u=a.constraint;r&&s.every(function(a){var o=a.data;return u.isMatch(r,o)?(i(e,t,r,o,n),!1):!0})&&o(e,t,r,n)}function u(e,t,r,a,o){n(e,t,r,a,o)}function c(e,t,r,n){y.__addToRightMemory(e,t,r),r.blocking=new p["default"];var a=e[t],o=g.memory_get(a.leftTuples,r).slice(),i=a.constraint;o.forEach(function(a){var o=a.data;i.isMatch(o,r)&&u(e,t,o,r,n)})}function l(e,t,r,n){var a=e[t],o=a.constraint,i=a.rightTuples,s=!1,u=y.removeFromLeftMemory(e,t,r),c=void 0;if(u)c=u.data;else{var l=_.removeFromLeftBlockedMemory(e,t,r);s=!0,c=l&&l.data}if(!c)throw new Error;var f=void 0;if(c&&c.blocker&&(f=a.rightMemory[c.blocker.hashCode]),f){var d=f.data;o.isMatch(r,d)&&(s?y.modify(e,t,_.__cloneContext(e,t,c),n):y.assert(e,t,_.__cloneContext(e,t,c),n),r.blocker=d,_.addToLeftBlockedMemory(e,t,d.blocking.push(r)),r=null)}if(r&&i.length)for(var h={next:i.head};h=h.next;){var p=h.data;if(o.isMatch(r,p)){s?y.modify(e,t,_.__cloneContext(e,t,c),n):y.assert(e,t,_.__cloneContext(e,t,c),n),_.addToLeftBlockedMemory(e,t,p.blocking.push(r)),r.blocker=p,r=null;break}}r&&(y.__addToLeftMemory(e,t,r),s&&y.retract(e,t,_.__cloneContext(e,t,r),n))}function f(e,t,r,n){var a=y.removeFromRightMemory(e,t,r);if(!a)throw new Error;var o=e[t],i=a.data,s=o.constraint,u=o.leftTuples,c=u.length,l=i.blocking;if(y.__addToRightMemory(e,t,r),r.blocking=new p["default"],c||l.length){if(l.length)for(var f={next:l.head};f=f.next;){var d=f.data;if(d.blocker=null,s.isMatch(d,r))d.blocker=r,_.addToLeftBlockedMemory(e,t,r.blocking.push(d)),y.assert(e,t,_.__cloneContext(e,t,d),n),d=null;else{d.blocker=null;for(var h=a;h=h.next;){var g=h.data;if(s.isMatch(d,g)){d.blocker=g,_.addToLeftBlockedMemory(e,t,g.blocking.push(d)),y.assert(e,t,_.__cloneContext(e,t,d),n),d=null;break}}d&&y.__addToLeftMemory(e,t,d)}}if(c)for(var m={next:u.head};m=m.next;){var v=m.data;s.isMatch(v,r)&&(y.assert(e,t,_.__cloneContext(e,t,v),n),y.removeFromLeftMemory(e,t,v),_.addToLeftBlockedMemory(e,t,r.blocking.push(v)),v.blocker=r)}}}function d(e,t,r,n){if(!y.removeFromLeftMemory(e,t,r)){var a=_.removeFromLeftBlockedMemory(e,t,r);if(!a)throw new Error;y.retract(e,t,_.__cloneContext(e,t,a.data),n)}}function h(e,t,r,o){var i=y.removeFromRightMemory(e,t,r),s=i.data,u=s.blocking;u.length&&!function(){for(var r=e[t],i=r.constraint,s={next:u.head},c=function(){var u=s.data;_.removeFromLeftBlockedMemory(e,t,u);var c=g.memory_get(r.rightTuples,u);u&&c.every(function(r){var a=r.data;return i.isMatch(u,a)?(n(e,t,u,a,o),!1):!0})&&a(e,t,u,!0,o)};s=s.next;)c();u.clear()}()}Object.defineProperty(r,"__esModule",{value:!0});var p=e("../linked-list"),y=e("./beta-node"),_=e("./not-node"),g=e("./misc/memory");r.assert_left=s,r.assert_right=c,r.modify_left=l,r.modify_right=f,r.retract_left=d,r.retract_right=h},{"../linked-list":28,"./beta-node":31,"./misc/memory":41,"./not-node":45}],35:[function(e,t,r){function n(e,t,r,n){if(e.type_assert(r)){var a=n.getFactHandle(r),o=new d["default"](a,null,null).set(e.alias,r),i=a.id,s=o.factHash,u=t.factHash,c=!0,l=!1,f=void 0;try{for(var h,p=_getIterator3["default"](u);!(c=(h=p.next()).done);c=!0){var _=h.value,g=_slicedToArray3["default"](_,2),m=g[0],v=g[1];s.set(m,v)}}catch(b){l=!0,f=b}finally{try{!c&&p["return"]&&p["return"]()}finally{if(l)throw f}}var T=e.fromMemory[i];T||(T=e.fromMemory[i]={});var k=e.__equalityConstraints;if(k.some(function(e){return e(s,s)?!1:!0})){var w=y;return T[t.hashCode]=[t,w],w}e.__variables.forEach(function(e){s.set(e,r[e])});var x=o.clone(a,null,t.match.merge(o.match));return t.fromMatches[a.id]=x,T[t.hashCode]=[t,x],x}return y}function a(e,t,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:!1,i=arguments[5],s=e[t],u=n(s,r,a,i);return u.isMatch()&&o&&h.assert(e,t,u.clone(),i),u}function o(e,t,r,n){var o=e[t],i=r.factHash,s=o.from_assert(i);l["default"](s)?s.forEach(function(o){a(e,t,r,o,!0,n)}):void 0!==s&&a(e,t,r,s,!0,n)}function i(e,t,r,n){h.__addToLeftMemory(e,t,r),r.fromMatches={},o(e,t,r,n)}function s(e,t){var r=t.fact.id,n=e.fromMemory[r];if(n)for(var a in n){var o=n[a];if(o[1]===t){delete n[a],f["default"](n)&&delete e.fromMemory[r];break}}}function u(e,t,r,o){var i=h.removeFromLeftMemory(e,t,r),u=e[t];if(i){h.__addToLeftMemory(e,t,r);var c=i.data;r.fromMatches={};var f=r.fromMatches,d=c.fromMatches,y=u.from_assert(r.factHash);if(l["default"](y))y.forEach(function(n){var i=a(e,t,r,n,!1,o);if(i.isMatch()){var s=i.fact.id;s in d?h.modify(e,t,i.clone(),o):h.assert(e,t,i.clone(),o)}});else if(void 0!==y){var _=a(e,t,r,y,!1,o);if(_.isMatch()){var g=_.fact.id;g in d?h.modify(e,t,_.clone(),o):h.assert(e,t,_.clone(),o)}}for(var m in d)m in f||(s(u,d[m]),h.retract(e,t,d[m].clone(),o))}else p.assert_left(e,t,r,o);var v=r.fact,b=v.id,T=u.fromMemory[b];if(u.fromMemory[b]={},T){var k=v.object;for(var w in T){var x=T[w],j=x[0],M=x[1],E=M.isMatch();if(j.hashCode!==r.hashCode){var O=n(u,j,k,o);E&&h.retract(e,t,M.clone(),o),O.isMatch()&&(E?h.modify(e,t,O.clone(),o):h.assert(e,t,O.clone(),o))}}}}function c(e,t,r,n){var a=h.removeFromLeftMemory(e,t,r);if(a){var o=a.data,i=o.fromMatches;for(var u in i)s(e[t],i[u]),h.retract(e,t,i[u].clone(),n)}}Object.defineProperty(r,"__esModule",{value:!0});var l=e("lodash-ts/isArray"),f=e("lodash-ts/isEmpty"),d=e("../context"),h=e("./beta-node"),p=e("./join-node"),y={isMatch:function(){return!1}};r.assert_left=i,r.modify_left=u,r.retract_left=c},{"../context":18,"./beta-node":31,"./join-node":37,"lodash-ts/isArray":75,"lodash-ts/isEmpty":80}],36:[function(e,t,r){function n(e,t,r,n,a){var o=!1;if(e.type_assert(r)){var i=a.getFactHandle(r),s=new l["default"](i,null).mergeMatch(t.match).set(e.alias,r);if(n){var u=e.fromMemory[i.id];u||(u=e.fromMemory[i.id]={}),u[t.hashCode]=t}var c=s.factHash;o=e.__equalityConstraints.every(function(e){return e(c,c)})}return o}function a(e,t,r,a){var o=e[t],i=r.factHash,s=o.from_assert(i),u=!1;return c["default"](s)?(s.some(function(e){return n(o,r,e,!0,a)?(r.blocked=!0,!0):!1}),f.assert(e,t,r.clone(),a)):void 0===s||(r.blocked=n(o,r,s,!0,a))||f.assert(e,t,r.clone(),a),u}function o(e,t,r,n){f.__addToLeftMemory(e,t,r),a(e,t,r,n)}function i(e,t,r,a,o){var i=e[t],s=a.blocked,u=r.factHash,l=i.from_assert(u);c["default"](l)?l.some(function(e){return n(i,r,e,!0,o)?(r.blocked=!0,!0):!1}):void 0!==l&&(r.blocked=n(i,r,l,!0,o));var d=r.blocked;d?s||f.retract(e,t,a.clone(),o):s?f.assert(e,t,r.clone(),o):f.modify(e,t,r.clone(),o)}function s(e,t,r,n){var a=f.removeFromLeftMemory(e,t,r);if(!a)throw new Error;f.__addToLeftMemory(e,t,r),i(e,t,r,a.data,n);var o=e[t],s=o.fromMemory[r.fact.id];if(o.fromMemory[r.fact.id]={},s)for(var u in s)if(u!==r.hashCode){var c=s[u],l=f.removeFromLeftMemory(e,t,c);if(l){var d=c.clone();d.blocked=!1,f.__addToLeftMemory(e,t,d),i(e,t,d,l.data,n)}}}function u(e,t,r,n){var a=f.removeFromLeftMemory(e,t,r);if(a){var o=a.data;o.blocked||f.retract(e,t,o.clone(),n)}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("lodash-ts/isArray"),l=e("../context"),f=e("./beta-node");r.__findMatches=a,r.assert_left=o,r.modify_left=s,r.retract_left=u},{"../context":18,"./beta-node":31,"lodash-ts/isArray":75}],37:[function(e,t,r){function n(e,t,r,n,a){var o=e[t],i=o.constraint.match(r,n);i.isMatch&&f.assert(e,t,f.__addToMemoryMatches(e,t,n,r,r.clone(null,null,i)),a)}function a(e,t,r,a){f.__addToLeftMemory(e,t,r);var o=e[t],i=d.memory_get(o.rightTuples,r);i.forEach(function(o){n(e,t,r,o.data,a)})}function o(e,t,r,n,a){var o=e[t],i=o.constraint.match(n,r);i.isMatch&&f.assert(e,t,f.__addToMemoryMatches(e,t,r,n,r.clone(null,null,i)),a)}function i(e,t,r,n){f.__addToRightMemory(e,t,r);var a=e[t],i=d.memory_get(a.leftTuples,r);i.forEach(function(a){o(e,t,r,a.data,n)})}function s(e,t,r,a,o,i){var s=e[t],u=o.hashCode;if(u in a){var c=s.constraint.match(r,o),l=c.isMatch;l?f.modify(e,t,f.__addToMemoryMatches(e,t,o,r,r.clone(null,null,c)),i):f.retract(e,t,a[u].clone(),i)}else n(e,t,r,o,i)}function u(e,t,r,n){var a=f.removeFromLeftMemory(e,t,r).data;f.__addToLeftMemory(e,t,r);var o=e[t],i=d.memory_get(o.rightTuples,r);if(i.length){var u=a.rightMatches;i.forEach(function(a){s(e,t,r,u,a.data,n)})}else f.propagateRetractModifyFromLeft(e,t,a,n)}function c(e,t,r,n,a,i){var s=a.hashCode;if(s in n){var u=e[t],c=u.constraint.match(a,r),l=c.isMatch;l?f.modify(e,t,f.__addToMemoryMatches(e,t,r,a,r.clone(null,null,c)),i):f.retract(e,t,n[s].clone(),i)}else o(e,t,r,a,i)}function l(e,t,r,n){var a=f.removeFromRightMemory(e,t,r).data;f.__addToRightMemory(e,t,r);var o=e[t],i=d.memory_get(o.leftTuples,r);if(i.length){var s=a.leftMatches;i.forEach(function(a){c(e,t,r,s,a.data,n)})}else f.propagateRetractModifyFromRight(e,t,a,n)}Object.defineProperty(r,"__esModule",{value:!0});var f=e("./beta-node"),d=e("./misc/memory");r.assert_left=a,r.assert_right=i,r.modify_left=u,r.modify_right=l},{"./beta-node":31,"./misc/memory":41}],38:[function(e,t,r){function n(e,t,r){return e===t[1]&&(r=f[r]),r}function a(e,t){if(u.is_instance_of_reference_eq_constraint(t)){var r=t.getIndexableProperties(),a=t.a;if(2===r.length&&a){for(var o=void 0,i=void 0,s=-1,c=[];++s<2;){var f=r[s];null===f.match(new RegExp("^"+a+"(\\.?)"))?(c.push(f),o=f):(c.push(f),i=f)}if(o&&i){var d=n(o,c,t.op),h=n(i,c,t.op);l.addIndex(e.rightMemory,i,o,h),l.addIndex(e.leftMemory,o,i,d)}}}e.isDefault?(e.constraint=t,e.isDefault=!1):e.constraint=t=e.constraint.merge(t);var p=t.assert;e.equal=function(e){return t.equal(e.constraint)},e.isMatch=function(e,t){return p(e.factHash,t.factHash)},e.match=function(e,t){return p(e.factHash,t.factHash)?e.match.merge(t.match):{isMatch:!1}}}function o(e,t){var r=d,n=d.assert;return i["default"](c.create_node(s.nodeType.join_reference),{constraint:r,isDefault:!0,leftMemory:e,rightMemory:t,equal:function(e){return r.equal(e.constraint)},isMatch:function(e,t){return n(e.factHash,t.factHash)},match:function(e,t){return n(e.factHash,t.factHash)?e.match.merge(t.match):{isMatch:!1}}})}Object.defineProperty(r,"__esModule",{value:!0});var i=e("lodash-ts/mixin"),s=e("../nodes"),u=e("../constraint"),c=e("../compile/nodes"),l=e("./misc/memory"),f={gt:"lte",gte:"lte",lt:"gte",lte:"gte",eq:"eq",neq:"neq"};r.addConstraint=a;var d={assert:function(){return!0},equal:function(){return!1}};r.create_join_reference_node=o},{"../compile/nodes":7,"../constraint":17,"../nodes":29,"./misc/memory":41,"lodash-ts/mixin":95}],39:[function(e,t,r){function n(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,f=_slicedToArray3["default"](l,2),p=f[0],y=f[1],_=d["default"](y,r.paths);_.length&&h.base_assert_left(e,p,r.clone(null,_,null),n)}}catch(g){i=!0,s=g}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function a(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}h.base_assert_left(e,d,r,n)}}catch(p){i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function o(e,t,r,o){e[t];r.paths?n(e,t,r,o):a(e,t,r,o)}function i(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,f=_slicedToArray3["default"](l,2),p=f[0],y=f[1],_=d["default"](y,r.paths);_.length&&h.base_modify_left(e,p,r.clone(null,_,null),n)}}catch(g){i=!0,s=g}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function s(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}h.base_modify_left(e,d,r,n)}}catch(p){
i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function u(e,t,r,n){e[t];r.paths?i(e,t,r,n):s(e,t,r,n)}function c(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,f=_slicedToArray3["default"](l,2),p=f[0],y=f[1],_=d["default"](y,r.paths);_.length&&h.base_retract_left(e,p,r.clone(null,_,null),n)}}catch(g){i=!0,s=g}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function l(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}h.base_retract_left(e,d,r,n)}}catch(p){i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function f(e,t,r,n){r.paths?c(e,t,r,n):l(e,t,r,n)}Object.defineProperty(r,"__esModule",{value:!0});var d=e("lodash-ts/intersection"),h=e("./node");r.assert=o,r.modify=u,r.retract=f},{"./node":44,"lodash-ts/intersection":73}],40:[function(e,t,r){function n(e,t,r){var n=void 0,a=0,o=-1;if(r>y)for(;y&&++o<r;)h[(n=t[o]).hashCode]&&(e[a++]=n,y--);else e.push.apply(e,_toConsumableArray3["default"](t));y=0,h={}}function a(e,t,r){var n=void 0,a=0,o=-1;if(r>p)for(;++o<r;)p?d[(n=t[o]).hashCode]?p--:e[a++]=n:e[a++]=t[o];p=0,d={}}function o(e,t,r){y===r?u(e,r):r>p&&t.filter(function(e){var t=e.hashCode;return!d[t]&&h[t]}).forEach(function(t){e.push(t)}),p=0,d={},y=0,h={}}function i(e,t){var r=f;return t&&(p||y?(r=[],p?y?o(r,e,t):a(r,e,t):n(r,e,t)):r=e),r}function s(e,t,r){var n=void 0;return"gt"===e?n=t.findGT(r):"gte"===e?n=t.findGTE(r):"lt"===e?n=t.findLT(r):"lte"===e&&(n=t.findLTE(r)),n}function u(e,t){if(t)for(var r=-1;++r<t;){var n=e[r].hashCode;d[n]||(d[n]=!0,p++)}}function c(e,t){if(t)for(var r=-1;++r<t;){var n=e[r].hashCode;h[n]||(h[n]=!0,y++)}}function l(e,t,r){for(var n=r.length,a=!1,o=e.tables,l=e.tuples,d=-1,h=l.length,p=void 0;++d<n&&h;){var y=r[d],_=y[3](t),g=y[4],m=o.get(y[0]),v=void 0;if("eq"===g||"seq"===g){var b=m.get(_);b?(h=(l=(e=b).tuples).length,o=b.tables):h=(l=f).length}else if("neq"===g||"sneq"===g){var T=m.get(_);T&&(p=(v=T.tuples).length,u(v,p))}else a?(p=(v=s(g,m,_)).length)?c(v,p):(l=v,h=p):(h=(l=s(g,m,_)).length,a=!0)}return i(l,h)}Object.defineProperty(r,"__esModule",{value:!0});var f=[],d={},h={},p=0,y=0;r["default"]=l},{}],41:[function(e,t,r){function n(){return{length:0,head:null,tail:null,indexes:[],tables:new h["default"](null,new p["default"],!1)}}function a(e,t){var r=e.tail,n=e.head,a={data:t,tuples:[],hashCode:g++,prev:r,next:null};return r&&(e.tail.next=a),e.tail=a,n||(e.head=a),e.length++,u(e,a),e.tables.addNode(a),a}function o(e,t){t.prev?t.prev.next=t.next:e.head=t.next,t.next?t.next.prev=t.prev:e.tail=t.prev,e.tables.removeNode(t),c(e,t),e.length--}function i(e){e.head=e.tail=null,e.length=0,s(e)}function s(e){e.tables.reset(),e.indexes.length=0}function u(e,t){for(var r=t.data,n=r.factHash,a=e.indexes,o=a.length,i=e.tables,s=-1,u=void 0,c=void 0,l=void 0;++s<o;){var f=a[s],d=f[2](n),y=f[0],_=i.tables;_.has(y)||_.set(y,new p["default"]),(u=(c=_.get(y)).get(d))||(u=new h["default"](d,c,!0),c.set(d,u)),c!==l&&t.tuples.push(u.addNode(t)),l=c,"eq"===f[4]&&(i=u)}}function c(e,t){for(var r=t.tuples,n=r.length;--n>=0;)r[n].removeNode(t);t.tuples.length=0}function l(e,t){var r=void 0;return r=e.length?_["default"](e.tables,t.factHash,e.indexes):[]}function f(e){var t=e.tables.reset(),r=e.indexes;t.set(r[0][0],new p["default"])}function d(e,t,r,n){e.indexes.push([t,r,y.plucker(t),y.plucker(r),n||"eq"]),e.indexes.sort(function(e,t){var r=e[4],n=t[4];return r===n?0:r>n?1:r===n?0:-1}),f(e)}Object.defineProperty(r,"__esModule",{value:!0});var h=e("./tuple-entry"),p=e("./table"),y=e("../../lang"),_=e("./get-memory"),g=0;r["default"]=n,r.memory_push=a,r.memory_remove=o,r.memory_clear=i,r.memory_get=l,r.addIndex=d},{"../../lang":25,"./get-memory":40,"./table":42,"./tuple-entry":43}],42:[function(e,t,r){function n(e,t){var r=e.key,n=t.key,a=void 0;return a=r==n?0:r>n?1:n>r?-1:1}function a(e,t){return 1===n(e,t)}function o(e,t){return-1!==n(e,t)}function i(e,t){return-1===n(e,t)}function s(e,t){return 1!==n(e,t)}function u(e,t,r){d.key=t;for(var n=[],a=0,o=e.get_root(),i=void 0;;)if(o)o=(f[a++]=o).left;else{if(!(a>0))break;if(i=(o=f[--a]).data,!r(i,d))break;n.push.apply(n,_toConsumableArray3["default"](i.value.tuples)),o=o.right}return f.length=0,n}function c(e,t,r){d.key=t;for(var n=[],a=0,o=e.get_root();;)if(o)o=(f[a++]=o).right;else{if(!(a>0))break;var i=(o=f[--a]).data;if(!r(i,d))break;n.push.apply(n,_toConsumableArray3["default"](i.value.tuples)),o=o.left}return f.length=0,n}Object.defineProperty(r,"__esModule",{value:!0});var l=e("../../leafy/avl-tree"),f=[],d={key:null},h=function(e){function t(){_classCallCheck3["default"](this,t);var e=_possibleConstructorReturn3["default"](this,(t.__proto__||_getPrototypeOf2["default"](t)).call(this,n));return e.hasGTCache=!1,e.hasGTECache=!1,e.hasLTCache=!1,e.hasLTECache=!1,e.gtCache=new _map2["default"],e.gteCache=new _map2["default"],e.ltCache=new _map2["default"],e.lteCache=new _map2["default"],e}return _inherits3["default"](t,e),_createClass3["default"](t,[{key:"clearCache",value:function(){this.hasGTCache&&this.gtCache.clear()&&(this.hasGTCache=!1),this.hasGTECache&&this.gteCache.clear()&&(this.hasGTECache=!1),this.hasLTCache&&this.ltCache.clear()&&(this.hasLTCache=!1),this.hasLTECache&&this.lteCache.clear()&&(this.hasLTECache=!1)}},{key:"contains_by_key",value:function(e){return this.contains({key:e})}},{key:"set",value:function(e,t){this.insert({key:e,value:t}),this.clearCache()}},{key:"get",value:function(e){var t=this.find({key:e});return t&&t.value}},{key:"remove_by_key",value:function(e){return this.clearCache(),this.remove({key:e})}},{key:"findGT",value:function(e){var t=this.gtCache.get(e);return t||(this.hasGTCache=!0,this.gtCache.set(e,t=c(this,e,a))),t}},{key:"findGTE",value:function(e){var t=this.gteCache.get(e);return t||(this.hasGTECache=!0,this.gteCache.set(e,t=c(this,e,o))),t}},{key:"findLT",value:function(e){var t=this.ltCache.get(e);return t||(this.hasLTCache=!0,this.ltCache.set(e,t=u(this,e,i))),t}},{key:"findLTE",value:function(e){var t=this.lteCache.get(e);return t||(this.hasLTECache=!0,this.lteCache.set(e,t=u(this,e,s))),t}}]),t}(l["default"]);r["default"]=h},{"../../leafy/avl-tree":26}],43:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=0,a=function(){function e(t,r,a){_classCallCheck3["default"](this,e),this.tuples=[],this.hashCode=n++,this.tables=new _map2["default"],this.entry=null,this.canRemove=!1,this.length=0,this.val=t,this.canRemove=a,this.entry=r}return _createClass3["default"](e,[{key:"reset",value:function(){return this.tables=new _map2["default"],this.tables}},{key:"addNode",value:function(e){return this.tuples[this.length++]=e,this.length>1&&this.entry.clearCache(),this}},{key:"removeNode",value:function(e){var t=this.tuples,r=t.indexOf(e);-1!==r&&(t.splice(r,1),this.length--,this.entry.clearCache()),this.canRemove&&!this.length&&this.entry.remove(this.val)}}]),e}();r["default"]=a},{}],44:[function(e,t,r){function n(e,t,r,n){var a=e[t],o=T.get(a.tp);if(!o)throw console.error(a,r),"cannot find method assert_left";o(e,t,r,n)}function a(e,t,r,n){var a=e[t],o=k.get(a.tp);if(!o)throw console.error(a,r),"cannot find method assert_right";o(e,t,r,n)}function o(e,t,r,n){var a=e[t],i=b.get(a.tp);if(i)i(e,t,r,n);else{console.error(a,r);var s=!0,u=!1,c=void 0;try{for(var l,f=_getIterator3["default"](a.nodes.entries());!(s=(l=f.next()).done);s=!0){{var d=l.value,h=_slicedToArray3["default"](d,2),p=h[0];h[1]}o(e,p,r,n)}}catch(y){u=!0,c=y}finally{try{!s&&f["return"]&&f["return"]()}finally{if(u)throw c}}}}function i(e,t,r,n){var a=e[t],o=x.get(a.tp);if(!o)throw console.error(a,r),"cannot find method retract_left";o(e,t,r,n)}function s(e,t,r,n){var a=e[t],o=j.get(a.tp);if(!o)throw console.error(a,r),"cannot find method retract_right";o(e,t,r,n)}function u(e,t,r,n){var a=e[t],o=w.get(a.tp);if(o)o(e,t,r,n);else{console.error(a,r);var i=!0,s=!1,c=void 0;try{for(var l,f=_getIterator3["default"](a.nodes.entries());!(i=(l=f.next()).done);i=!0){{var d=l.value,h=_slicedToArray3["default"](d,2),p=h[0];h[1]}u(e,p,r,n)}}catch(y){s=!0,c=y}finally{try{!i&&f["return"]&&f["return"]()}finally{if(s)throw c}}}}function c(e,t,r,n){var a=e[t],o=E.get(a.tp);if(!o)throw console.error(a,r),"cannot find method modify_left";o(e,t,r,n)}function l(e,t,r,n){var a=e[t],o=O.get(a.tp);if(!o)throw console.error(a,r),"cannot find method modify_right";o(e,t,r,n)}function f(e,t,r,n){var a=e[t],o=M.get(a.tp);if(o)o(e,t,r,n);else{console.error(a,r);var i=!0,s=!1,u=void 0;try{for(var c,l=_getIterator3["default"](a.nodes.entries());!(i=(c=l.next()).done);i=!0){{var d=c.value,h=_slicedToArray3["default"](d,2),p=h[0];h[1]}f(e,p,r,n)}}catch(y){s=!0,u=y}finally{try{!i&&l["return"]&&l["return"]()}finally{if(s)throw u}}}}function d(e,t,r){var n=e[t],a=A.get(n.tp);if(a)a(e,t,r);else{var o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](n.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),h=f[0];f[1]}d(e,h,r)}}catch(p){i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}}function h(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,d=_slicedToArray3["default"](l,2),h=d[0],p=d[1],y=g["default"](p,r.paths);y.length&&f(e,h,new v["default"](r.fact,y,r.match),n)}}catch(_){i=!0,s=_}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function p(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var c,l=_getIterator3["default"](a.nodes.entries());!(o=(c=l.next()).done);o=!0){var f=c.value,d=_slicedToArray3["default"](f,2),h=d[0],p=d[1],y=g["default"](p,r.paths);y.length&&u(e,h,new v["default"](r.fact,y,r.match),n)}}catch(_){i=!0,s=_}finally{try{!o&&l["return"]&&l["return"]()}finally{if(i)throw s}}}function y(e,t,r,n){var a=e[t],i=!0,s=!1,u=void 0;try{for(var c,l=_getIterator3["default"](a.nodes.entries());!(i=(c=l.next()).done);i=!0){var f=c.value,d=_slicedToArray3["default"](f,2),h=d[0],p=d[1],y=g["default"](p,r.paths);y.length&&o(e,h,new v["default"](r.fact,y,r.match),n)}}catch(_){s=!0,u=_}finally{try{!i&&l["return"]&&l["return"]()}finally{if(s)throw u}}}function _(e,t,r){var n=e[t],a=!0,o=!1,i=void 0;try{for(var s,u=_getIterator3["default"](n.nodes.entries());!(a=(s=u.next()).done);a=!0){{var c=s.value,l=_slicedToArray3["default"](c,2),f=l[0];l[1]}d(e,f,r)}}catch(h){o=!0,i=h}finally{try{!a&&u["return"]&&u["return"]()}finally{if(o)throw i}}}Object.defineProperty(r,"__esModule",{value:!0});var g=e("lodash-ts/intersection"),m=e("../nodes"),v=e("../context"),b=new _map2["default"],T=new _map2["default"],k=new _map2["default"],w=new _map2["default"],x=new _map2["default"],j=new _map2["default"],M=new _map2["default"],E=new _map2["default"],O=new _map2["default"],A=new _map2["default"],C=e("./type-node");b.set(m.nodeType.type,C.assert),M.set(m.nodeType.type,C.modify),w.set(m.nodeType.type,C.retract),A.set(m.nodeType.type,C.dispose);var q=e("./terminal-node");b.set(m.nodeType.terminal,q.assert),M.set(m.nodeType.terminal,q.modify),w.set(m.nodeType.terminal,q.retract);var L=e("./left-adapter-node");b.set(m.nodeType.leftadapter,L.assert),M.set(m.nodeType.leftadapter,L.modify),w.set(m.nodeType.leftadapter,L.retract);var P=e("./right-adapter-node");b.set(m.nodeType.rightadapter,P.assert),M.set(m.nodeType.rightadapter,P.modify),w.set(m.nodeType.rightadapter,P.retract);var I=e("./alias-node");b.set(m.nodeType.alias,I.assert),M.set(m.nodeType.alias,I.modify),w.set(m.nodeType.alias,I.retract);var S=e("./equality-node");b.set(m.nodeType.equality,S.assert),M.set(m.nodeType.equality,S.modify),w.set(m.nodeType.equality,S.retract);var R=e("./property-node");b.set(m.nodeType.property,R.assert),M.set(m.nodeType.property,R.modify),w.set(m.nodeType.property,R.retract);var F=e("./beta-node");b.set(m.nodeType.beta,F.assert),M.set(m.nodeType.beta,F.modify),w.set(m.nodeType.beta,F.retract),T.set(m.nodeType.beta,F.assert_left),k.set(m.nodeType.beta,F.assert_right),E.set(m.nodeType.beta,F.modify_left),O.set(m.nodeType.beta,F.modify_right),x.set(m.nodeType.beta,F.retract_left),j.set(m.nodeType.beta,F.retract_right),A.set(m.nodeType.beta,F.dispose);var N=e("./join-node");b.set(m.nodeType.join,F.assert),M.set(m.nodeType.join,F.modify),w.set(m.nodeType.join,F.retract),T.set(m.nodeType.join,N.assert_left),k.set(m.nodeType.join,N.assert_right),E.set(m.nodeType.join,N.modify_left),O.set(m.nodeType.join,N.modify_right),x.set(m.nodeType.join,F.retract_left),j.set(m.nodeType.join,F.retract_right),A.set(m.nodeType.join,F.dispose);var $=e("./not-node");b.set(m.nodeType.not,F.assert),M.set(m.nodeType.not,F.modify),w.set(m.nodeType.not,F.retract),T.set(m.nodeType.not,$.assert_left),k.set(m.nodeType.not,$.assert_right),E.set(m.nodeType.not,$.modify_left),O.set(m.nodeType.not,$.modify_right),x.set(m.nodeType.not,$.retract_left),j.set(m.nodeType.not,$.retract_right),A.set(m.nodeType.not,F.dispose);var D=e("./from-node");b.set(m.nodeType.from,F.assert),M.set(m.nodeType.from,F.modify),w.set(m.nodeType.from,F.retract),T.set(m.nodeType.from,D.assert_left),E.set(m.nodeType.from,D.modify_left),x.set(m.nodeType.from,D.retract_left),A.set(m.nodeType.from,F.dispose);var H=e("./exists-node");b.set(m.nodeType.exists,F.assert),M.set(m.nodeType.exists,F.modify),w.set(m.nodeType.exists,F.retract),T.set(m.nodeType.exists,H.assert_left),k.set(m.nodeType.exists,H.assert_right),E.set(m.nodeType.exists,H.modify_left),O.set(m.nodeType.exists,H.modify_right),x.set(m.nodeType.exists,H.retract_left),j.set(m.nodeType.exists,H.retract_right),A.set(m.nodeType.exists,F.dispose);var B=e("./from-not-node");b.set(m.nodeType.from_not,F.assert),M.set(m.nodeType.from_not,F.modify),w.set(m.nodeType.from_not,F.retract),T.set(m.nodeType.from_not,B.assert_left),E.set(m.nodeType.from_not,B.modify_left),x.set(m.nodeType.from_not,B.retract_left),A.set(m.nodeType.from_not,F.dispose);var G=e("./exists-from-node");b.set(m.nodeType.exists_from,F.assert),M.set(m.nodeType.exists_from,F.modify),w.set(m.nodeType.exists_from,F.retract),T.set(m.nodeType.exists_from,G.assert_left),E.set(m.nodeType.exists_from,G.modify_left),x.set(m.nodeType.exists_from,G.retract_left),A.set(m.nodeType.exists_from,F.dispose),r.base_assert_left=n,r.base_assert_right=a,r.base_assert=o,r.base_retract_left=i,r.base_retract_right=s,r.base_retract=u,r.base_modify_left=c,r.base_modify_right=l,r.base_modify=f,r.base_dispose=d,r.propagate_modify=h,r.propagate_retract=p,r.propagate_assert=y,r.propagate_dispose=_},{"../context":18,"../nodes":29,"./alias-node":30,"./beta-node":31,"./equality-node":32,"./exists-from-node":33,"./exists-node":34,"./from-node":35,"./from-not-node":36,"./join-node":37,"./left-adapter-node":39,"./not-node":45,"./property-node":46,"./right-adapter-node":47,"./terminal-node":49,"./type-node":50,"lodash-ts/intersection":73}],45:[function(e,t,r){function n(e,t,r){var n=e[t],a=r.data,o=a.hashCode,i=n.leftMemory[o];return n.leftTupleMemory[o]=r,i&&v.memory_remove(n.leftTuples,i),n}function a(e,t,r){var n=e[t];return r.clone(null,null,r.match.merge(n.notMatch))}function o(e,t,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:!1,s=arguments[5];r.blocker=o,m.removeFromLeftMemory(e,t,r),n(e,t,o.blocking.push(r)),i&&m.retract(e,t,a(e,t,r),s)}function i(e,t,r,n,a){o(e,t,r,n,!1,a)}function s(e,t,r,n){var a=e[t],o=v.memory_get(a.rightTuples,r),s=a.constraint;r&&o.every(function(a){var o=a.data;return s.isMatch(r,o)?(i(e,t,r,o,n),!1):!0})&&f(e,t,r,n)}function u(e,t,r,n){m.__addToRightMemory(e,t,r),r.blocking=new g["default"];var a=e[t],o=v.memory_get(a.leftTuples,r).slice(),i=a.constraint;o.forEach(function(a){var o=a.data;i.isMatch(o,r)&&d(e,t,o,r,n)})}function c(e,t,r,n){var a=m.removeFromRightMemory(e,t,r),i=a.data,s=i.blocking;s.length&&!function(){for(var r=e[t],a=r.constraint,i={next:s.head},u=function(){var s=i.data;p(e,t,s);var u=v.memory_get(r.rightTuples,s);s&&u.every(function(r){var i=r.data;return a.isMatch(s,i)?(o(e,t,s,i,!1,n),!1):!0})&&l(e,t,s,!0,n)};i=i.next;)u();s.clear()}()}function l(e,t,r,n,o){m.__addToLeftMemory(e,t,r),n&&m.assert(e,t,a(e,t,r),o)}function f(e,t,r,n){l(e,t,r,!0,n)}function d(e,t,r,n,a){o(e,t,r,n,!0,a)}function h(e,t,r,n){var o=m.removeFromLeftMemory(e,t,r);if(o){var i=o.data;m.retract(e,t,a(e,t,i),n)}else if(!p(e,t,r))throw new Error}function p(e,t,r){var n=e[t],a=n.leftTupleMemory[r.hashCode]||null;return a&&(delete n.leftTupleMemory[r.hashCode],a.data.blocker.blocking.remove(a)),a}function y(e,t,r,o){var i=m.removeFromLeftMemory(e,t,r),s=e[t],u=s.constraint,c=v.memory_get(s.rightTuples,r),l=!1,f=i&&i.data;if(!f){var d=p(e,t,r);f=d.data,l=!0}if(!f)throw new Error;var h=void 0;if(f&&f.blocker&&(h=s.rightMemory[f.blocker.hashCode],f.blocker=null),h){var y=h.data;u.isMatch(r,y)&&(l||m.retract(e,t,a(e,t,f),o),r.blocker=y,n(e,t,y.blocking.push(r)),r=null)}r&&c.every(function(i){var s=i.data;return u.isMatch(r,s)?(l||m.retract(e,t,a(e,t,f),o),n(e,t,s.blocking.push(r)),r.blocker=s,!1):!0})&&(m.__addToLeftMemory(e,t,r),l?m.assert(e,t,a(e,t,r),o):m.modify(e,t,a(e,t,r),o))}function _(e,t,r,o){var i=m.removeFromRightMemory(e,t,r);if(!i)throw new Error;var s=i.data,u=e[t],c=v.memory_get(u.leftTuples,r).slice(),l=c.length,f=u.constraint,d=s.blocking;m.__addToRightMemory(e,t,r),r.blocking=new g["default"];for(var h={next:d.head};h=h.next;){var p=h.data;if(p.blocker=null,f.isMatch(p,r))p.blocker=r,n(e,t,r.blocking.push(p));else{p.blocker=null;for(var y=i;y=y.next;){var _=y.data;if(f.isMatch(p,_)){p.blocker=_,n(e,t,_.blocking.push(p));break}}p&&(m.__addToLeftMemory(e,t,p),m.assert(e,t,a(e,t,p),o))}}l&&c.forEach(function(i){var s=i.data;f.isMatch(s,r)&&(m.retract(e,t,a(e,t,s),o),m.removeFromLeftMemory(e,t,s),n(e,t,r.blocking.push(s)),s.blocker=r)})}Object.defineProperty(r,"__esModule",{value:!0});var g=e("../linked-list"),m=e("./beta-node"),v=e("./misc/memory");r.addToLeftBlockedMemory=n,r.__cloneContext=a,r.blockFromAssertLeft=i,r.assert_left=s,r.assert_right=u,r.retract_right=c,r.retract_left=h,r.removeFromLeftBlockedMemory=p,r.modify_left=y,r.modify_right=_},{"../linked-list":28,"./beta-node":31,"./misc/memory":41}],46:[function(e,t,r){function n(e,t,r,n){var a=e[t],o=new i["default"](r.fact,r.paths),u=a.constiables,c=r.fact.object;o.set(a.alias,c);for(var l in u){var f=u[l];o.set(f,c[l])}s.propagate_assert(e,t,o,n)}function a(e,t,r,n){var a=e[t],o=new i["default"](r.fact,r.paths),u=a.constiables,c=r.fact.object;o.set(a.alias,c);for(var l in u){var f=u[l];o.set(f,c[l])}s.propagate_modify(e,t,o,n)}function o(e,t,r,n){s.propagate_retract(e,t,new i["default"](r.fact,r.paths),n)}Object.defineProperty(r,"__esModule",{value:!0});var i=e("../context"),s=e("./node");r.assert=n,r.modify=a,r.retract=o},{"../context":18,"./node":44}],47:[function(e,t,r){function n(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,f=_slicedToArray3["default"](l,2),p=f[0],y=f[1],_=d["default"](y,r.paths);_.length&&h.base_assert_right(e,p,r.clone(null,_,null),n)}}catch(g){i=!0,s=g}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function a(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}h.base_assert_right(e,d,r,n)}}catch(p){i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function o(e,t,r,o){e[t];r.paths?n(e,t,r,o):a(e,t,r,o)}function i(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,f=_slicedToArray3["default"](l,2),p=f[0],y=f[1],_=d["default"](y,r.paths);_.length&&h.base_modify_right(e,p,r.clone(null,_,null),n)}}catch(g){i=!0,s=g}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function s(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}h.base_modify_right(e,d,r,n)}}catch(p){i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function u(e,t,r,n){r.paths?i(e,t,r,n):s(e,t,r,n)}function c(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){var l=u.value,f=_slicedToArray3["default"](l,2),p=f[0],y=f[1],_=d["default"](y,r.paths);_.length&&h.base_retract_right(e,p,r.clone(null,_,null),n)}}catch(g){i=!0,s=g}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function l(e,t,r,n){var a=e[t],o=!0,i=!1,s=void 0;try{for(var u,c=_getIterator3["default"](a.nodes.entries());!(o=(u=c.next()).done);o=!0){{var l=u.value,f=_slicedToArray3["default"](l,2),d=f[0];f[1]}h.base_retract_right(e,d,r,n)}}catch(p){i=!0,s=p}finally{try{!o&&c["return"]&&c["return"]()}finally{if(i)throw s}}}function f(e,t,r,n){r.paths?c(e,t,r,n):l(e,t,r,n)}Object.defineProperty(r,"__esModule",{value:!0});var d=e("lodash-ts/intersection"),h=e("./node");r.assert=o,r.modify=u,r.retract=f},{"./node":44,"lodash-ts/intersection":73}],48:[function(e,t,r){function n(e,t,r){e.tps.forEach(function(n){u.base_assert(e.ns,n,t,r)})}function a(e,t,r){e.tps.forEach(function(n){u.base_retract(e.ns,n,t,r)})}function o(e,t,r){e.tps.forEach(function(n){u.base_modify(e.ns,n,t,r)})}function i(e){e.tps.forEach(function(t){u.base_dispose(e.ns,t,void 0)})}function s(e,t){return e.ts.some(function(r){var n=e.ns[r];return n.r.n===t})}Object.defineProperty(r,"__esModule",{value:!0});var u=e("./node");r.assertFact=n,r.retractFact=a,r.modifyFact=o,r.dispose=i,r.containsRule=s},{"./node":44}],49:[function(e,t,r){function n(e,t,r){var n=e[t],a=r.match;if(a.isMatch){var o=n.r,i=n.b;n.agenda.insert(n,{rule:o,hashCode:r.hashCode,index:n.i,name:o.n,recency:i.recency++,match:a,counter:i.counter})}}function a(e,t,r){var a=e[t];a.agenda.retract(a,r),n(e,t,r)}function o(e,t,r){var n=e[t];n.agenda.retract(n,r)}Object.defineProperty(r,"__esModule",{value:!0}),r.assert=n,r.modify=a,r.retract=o},{}],50:[function(e,t,r){function n(e,t,r,n){var a=e[t];if(a.ca(r.object)){var o=!0,i=!1,c=void 0;try{for(var l,f=_getIterator3["default"](a.nodes.entries());!(o=(l=f.next()).done);o=!0){var d=l.value,h=_slicedToArray3["default"](d,2),p=h[0],y=h[1];s.base_assert(e,p,new u["default"](r,y),n)}}catch(_){i=!0,c=_}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw c}}}}function a(e,t,r,n){var a=e[t];if(a.ca(r.object)){var o=!0,i=!1,c=void 0;try{for(var l,f=_getIterator3["default"](a.nodes.entries());!(o=(l=f.next()).done);o=!0){var d=l.value,h=_slicedToArray3["default"](d,2),p=h[0],y=h[1];s.base_modify(e,p,new u["default"](r,y),n)}}catch(_){i=!0,c=_}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw c}}}}function o(e,t,r,n){var a=e[t];if(a.ca(r.object)){var o=!0,i=!1,c=void 0;try{for(var l,f=_getIterator3["default"](a.nodes.entries());!(o=(l=f.next()).done);o=!0){var d=l.value,h=_slicedToArray3["default"](d,2),p=h[0],y=h[1];s.base_retract(e,p,new u["default"](r,y),n)}}catch(_){i=!0,c=_}finally{try{!o&&f["return"]&&f["return"]()}finally{if(i)throw c}}}}function i(e,t){var r=e[t],n=!0,a=!1,o=void 0;try{for(var i,u=_getIterator3["default"](r.nodes.entries());!(n=(i=u.next()).done);n=!0){var c=i.value,l=_slicedToArray3["default"](c,2),f=l[0],d=l[1];s.base_dispose(e,f,{paths:d})}}catch(h){a=!0,o=h}finally{try{!n&&u["return"]&&u["return"]()}finally{if(a)throw o}}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./node"),u=e("../context");r.assert=n,r.modify=a,r.retract=o,r.dispose=i},{"../context":18,"./node":44}],51:[function(e,t,r){function n(e,t){var r=t.alias;if("function"==typeof e)throw new Error("do not support custom constraint.");var a=[],o=t.scope||{},i=e[2];if("and"===i)a=a.concat(n(e[0],t)).concat(n(e[1],t));else if("composite"===i||"or"===i||"lt"===i||"gt"===i||"lte"===i||"gte"===i||"like"===i||"notLike"===i||"eq"===i||"neq"===i||"seq"===i||"sneq"===i||"in"===i||"notIn"===i||"prop"===i||"propLookup"===i||"function"===i||"logicalNot"===i){var s=P.getIdentifiers(e).some(function(e){return!(e===r||e in F||e in o)});switch(i){case"eq":a.push(s?R.create_reference_equality_constraint(r,e,t):R.create_equality_constraint(r,e,t));break;case"seq":a.push(s?R.create_reference_equality_constraint(r,e,t):R.create_equality_constraint(r,e,t));break;case"neq":a.push(s?R.create_reference_inequality_constraint(r,e,t):R.create_inequality_constraint(r,e,t));break;case"sneq":a.push(s?R.create_reference_inequality_constraint(r,e,t):R.create_inequality_constraint(r,e,t));break;case"gt":a.push(s?R.create_reference_gt_constraint(r,e,t):R.create_comparison_constraint(r,e,t));break;case"gte":a.push(s?R.create_reference_gte_constraint(r,e,t):R.create_comparison_constraint(r,e,t));break;case"lt":a.push(s?R.create_reference_lt_constraint(r,e,t):R.create_comparison_constraint(r,e,t));break;case"lte":a.push(s?R.create_reference_lte_constraint(r,e,t):R.create_comparison_constraint(r,e,t));break;default:a.push(s?R.create_reference_constraint(r,e,t):R.create_comparison_constraint(r,e,t))}}return a}function a(e,t,r,a,o,i,s,u){var c=[R.create_object_constraint(a,t,r)],l=n(o,L["default"]({alias:a},s));if(l.length)c=c.concat(l);else{var f=R.create_true_constraint(a);c.push(f)}if(i&&!M["default"](i)){var d=R.create_hash_constraint(a,i);c.push(d)}var h=c.map(function(e){return u.push(e)-1});return{tp:e,id:++N,cls:t,class_type:r,a:a,pattern:s.pattern,constraints:h}}function o(e){return a(x.initial_fact,"InitialFact",I["default"],"__i__",[],{},{},e)}function i(e,t,r,n,o,i,s){return a(x.object,e,t,r,n,o,i,s)}function s(e,t,r,n,o,i,s,u,c){return L["default"](a(e,t,r,n,o,i,u,c),{from:R.create_from_constraint(n,s,u)})}function u(e,t){return{tp:x.composite,id:++N,leftPattern:e,rightPattern:t}}function c(e){if(void 0===e||null===e)return null;if(/^from +/.test(e))return{from:e.replace(/^from +/,"").replace(/^\s*|\s*$/g,"")};throw new Error("invalid rule constraint option "+e)}function l(e){switch(e.length){case 1:throw new Error("invalid rule constraint "+_stringify2["default"](e));case 2:return function(){return e.push("true"),e}();case 3:return function(){if(E["default"](e[2])&&/^from +/.test(e[2])){var t=e[2];e.splice(2,0,"true"),e[3]=null,e[4]=c(t)}else O["default"](e[2])&&e.splice(2,0,"true");return e}();case 4:return function(){return E["default"](e[3])&&(e.splice(3,0,null),e[4]=c(e[4])),e}();default:return function(){return 5===e.length&&(e[4]=c(e[4])),e}()}}function f(e){switch(e){case"string":return String;case"date":return Date;case"array":return Array;case"boolean":return Boolean;case"regexp":return RegExp;case"number":return Number;case"object":case"hash":return Object;default:throw new TypeError("invalid param type "+e)}}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(E["default"](e)){var r=e,n=t[r];return n?n:f(r.toLowerCase())}if(A["default"](e))return e;if(C["default"](e,[]))return Array;throw new Error("invalid param type "+e)}function h(e,t){return e.shift(),q["default"](e.map(function(r){return r.scope=e.scope,w(r,t)}))}function p(e){return"function"==typeof e?e:S["default"](e)}function y(e,t,r,n,a,o,i,u){return s(x.from_not,e,t,r,n,a,o,i,u)}function _(e,t,r,n,o,i,s){return a(x.not,e,t,r,n,o,i,s)}function g(e,t){return e.shift(),e=l(e),e[4]&&e[4].from?[y(e[0][0],d(e[0][1],e.scope),e[1]||"m",p(e[2]||"true"),e[3]||{},p(e[4].from),{scope:e.scope,pattern:e[2]},t)]:[_(e[0][0],d(e[0][1],e.scope),e[1]||"m",p(e[2]||"true"),e[3]||{},{scope:e.scope,pattern:e[2]},t)]}function m(e,t,r,n,a,o,i,u){return s(x.from_exists,e,t,r,n,a,o,i,u)}function v(e,t,r,n,o,i,s){return a(x.exists,e,t,r,n,o,i,s)}function b(e,t){return e.shift(),e=l(e),e[4]&&e[4].from?[m(e[0][0],d(e[0][1],e.scope),e[1]||"m",p(e[2]||"true"),e[3]||{},p(e[4].from),{scope:e.scope,pattern:e[2]},t)]:[v(e[0][0],d(e[0][1],e.scope),e[1]||"m",p(e[2]||"true"),e[3]||{},{scope:e.scope,pattern:e[2]},t)]}function T(e,t,r,n,a,o,i,u){return s(x.from,e,t,r,n,a,o,i,u)}function k(e,t){return"function"==typeof e?[e]:(e=l(e),e[4]&&e[4].from?[T(e[0][0],d(e[0][1],e.scope),e[1]||"m",p(e[2]||"true"),e[3]||{},p(e[4].from),{scope:e.scope,pattern:e[2]},t)]:[i(e[0][0],d(e[0][1],e.scope),e[1]||"m",p(e[2]||"true"),e[3]||{},{scope:e.scope,pattern:e[2]},t)])}function w(e,t){switch(e[0]){case"or":return h(e,t);case"not":return g(e,t);case"exists":return b(e,t);default:return k(e,t)}}Object.defineProperty(r,"__esModule",{value:!0});var x,j=e("lodash-ts/isNumber"),M=e("lodash-ts/isEmpty"),E=e("lodash-ts/isString"),O=e("lodash-ts/isHash"),A=e("lodash-ts/isFunction"),C=e("lodash-ts/isEqual"),q=e("lodash-ts/flattenDeep"),L=e("lodash-ts/mixin"),P=e("./constraint-matcher"),I=e("./facts/initial"),S=e("./compile/parser/constraint"),R=e("./constraint");!function(e){e[e.composite=0]="composite",e[e.object=1]="object",e[e.exists=2]="exists",e[e.from=3]="from",e[e.from_exists=4]="from_exists",e[e.from_not=5]="from_not",e[e.initial_fact=6]="initial_fact",e[e.not=7]="not"}(x=r.patternType||(r.patternType={}));var F={now:function(){return new Date},Date:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,r,n,a,o,i){var s=new Date;return j["default"](e)&&s.setFullYear(e),j["default"](t)&&s.setMonth(t),j["default"](r)&&s.setDate(r),j["default"](n)&&s.setHours(n),j["default"](a)&&s.setMinutes(a),j["default"](o)&&s.setSeconds(o),j["default"](i)&&s.setMilliseconds(i),s}),lengthOf:function(e,t){return e.length===t},isTrue:function(e){return e===!0},isFalse:function(e){return e===!1},isNotNull:function(e){return null!==e},dateCmp:function(e,t){return e>t?1:t>e?-1:0}},N=0;r.initial_fact_pattern=o,r.composite_pattern=u,r["default"]=w},{"./compile/parser/constraint":8,"./constraint":17,"./constraint-matcher":16,"./facts/initial":21,"lodash-ts/flattenDeep":72,"lodash-ts/isEmpty":80,"lodash-ts/isEqual":81,"lodash-ts/isFunction":82,"lodash-ts/isHash":83,"lodash-ts/isNumber":86,"lodash-ts/isString":90,"lodash-ts/mixin":95}],52:[function(e,t,r){function n(e,t){var r={define:[],rules:[],scope:[]},n=o.get_defines(t.define),s=a.to_map(t.scope),u=new i["default"](e,n,s),c=!0,l=!1,f=void 0;try{for(var d,h=_getIterator3["default"](n);!(c=(d=h.next()).done);c=!0){var p=d.value,y=_slicedToArray3["default"](p,2),_=y[0],g=y[1];u.addDefined(_,g)}}catch(m){l=!0,f=m}finally{try{!c&&h["return"]&&h["return"]()}finally{if(l)throw f}}return r.scope.forEach(function(e){s.set(e.name,o.createFunction(e.body,n,s))}),u}Object.defineProperty(r,"__esModule",{value:!0});var a=e("../lang"),o=e("../compile"),i=e("../flow-container");r["default"]=n},{"../compile":3,"../flow-container":22,"../lang":25}],53:[function(e,t,r){function n(e){var t=e.a;return{tp:h.constraintType["true"],a:t,assert:function(){return!0},equal:function(e){return e.tp==h.constraintType["true"]&&t===e.a}}}function a(e,t){var r=e.scope2;if(r){t=new _map2["default"](t);for(var n in r)t.set(n,r[n])}return{scope:t,pattern:e.pattern,alias:e.alias}}function o(e,t,r){var n=a(e.options,r),o=e.constraint,i=p.getMatcher(o,n,!0),s=e.a;return{tp:e.tp,a:s,constraint:o,assert:function(e,t){return i(e,t)},equal:function(e){return e.a==s,d["default"](o,e.constraint)}}}function i(e,t){var r=t.get(e.cls),n=e.a;return{tp:h.constraintType.object,a:n,constraint:r,assert:function(e){return e instanceof r||e.constructor===r},equal:function(e){return e.tp===h.constraintType.object&&r===e.constraint}}}function s(e){var t=e.a,r=f["default"](e.constraint);return{tp:h.constraintType.hash,a:t,constraint:r,assert:function(){return!0},equal:function(e){return e.tp===h.constraintType.hash&&e.a===t&&d["default"](r,e.constraint)}}}function u(e,t,r){var n=e.a,o=e.condition,i=a(e.options,r),s=p.getSourceMatcher(o,i,!0);return{tp:h.constraintType.from,
options:i,condition:o,a:n,constraint:s,assert:function(e,t){return s(e,t)},equal:function(e){return e.tp===h.constraintType.from&&e.a===n&&d["default"](o,e.constraint)}}}function c(e,t,r){var n=e.a,o=a(e.options,r),i=e.constraint,s=p.getMatcher(i,o,!1);return{options:o,op:e.op,tp:e.tp,a:n,constraint:i,vars:f["default"](e.vars,!0),assert:function(e,t){return s(e,t)},getIndexableProperties:function(){return p.getIndexableProperties(i)},equal:function(e){return h.is_instance_of_reference_constraint(e)&&d["default"](i,e.constraint)}}}function l(e,t,r){var n=y.get(e.tp);return n(e,t,r)}Object.defineProperty(r,"__esModule",{value:!0});var f=e("lodash-ts/clone"),d=e("lodash-ts/isEqual"),h=e("../constraint"),p=e("../constraint-matcher"),y=new _map2["default"];y.set(h.constraintType["true"],n),y.set(h.constraintType.equality,o),y.set(h.constraintType.inequality,o),y.set(h.constraintType.comparison,o),y.set(h.constraintType.object,i),y.set(h.constraintType.hash,s),y.set(h.constraintType.from,u),y.set(h.constraintType.reference,c),y.set(h.constraintType.reference_equality,c),y.set(h.constraintType.reference_inequality,c),y.set(h.constraintType.reference_gt,c),y.set(h.constraintType.reference_gte,c),y.set(h.constraintType.reference_lt,c),y.set(h.constraintType.reference_lte,c),y.set(h.constraintType.reference,c),y.set(h.constraintType.reference,c),y.set(h.constraintType.reference,c),r["default"]=l},{"../constraint":17,"../constraint-matcher":16,"lodash-ts/clone":71,"lodash-ts/isEqual":81}],54:[function(e,t,r){function n(e,t){var r=_["default"](t,!0),n=r.nodes=new _map2["default"];return t.ns.forEach(function(t){var r=_slicedToArray3["default"](t,2),a=r[0],o=r[1];n.has(a)||n.set(a,[]),n.get(a).push(e[o])}),r}function a(e,t,r,n,a){var o=T["default"](e.r,n,a),i={id:e.id,r:o,agenda:r,b:t.bucket,i:e.i,n:e.n,nodes:e.nodes,ps:e.ps,tp:e.tp};return r.register(i),i}function o(e,t,r,n,a,o,i){var s=i[e.c];return{id:e.id,ca:s.assert,nodes:e.nodes,ps:e.ps,tp:e.tp}}function i(e,t,r,n,a,o,i){var s=i[e.c];return{id:e.id,ca:s.assert,nodes:e.nodes,ps:e.ps,memory:new _map2["default"],tp:e.tp}}function s(e,t,r,n,a,o,i){var s=i[e.c],u=e.alias;return{alias:u,id:e.id,constiables:_["default"](e.constiables),constraint:s,ca:s.assert,nodes:e.nodes,ps:e.ps,tp:e.tp}}function u(e,t,r,n,a,o){var i=o[e.p];return{constraint:i,alias:e.alias,id:e.id,nodes:e.nodes,ps:e.ps,tp:e.tp}}function c(e){return{id:e.id,nodes:e.nodes,ps:e.ps,tp:e.tp}}function l(e){return{id:e.id,nodes:e.nodes,ps:e.ps,tp:e.tp,leftMemory:{},rightMemory:{},leftTuples:w["default"](),rightTuples:w["default"]()}}function f(e,t,r,n,a,o,i){var s=e.constraint;e=l(e,t,r,n,a,o,i);var u=b.create_join_reference_node(e.leftTuples,e.rightTuples);return s.isDefault||b.addConstraint(u,k["default"](s.constraint,n,a)),g["default"](e,{constraint:u})}function d(e,t,r,n,a,o,i){return e=f(e,t,r,n,a,o,i),g["default"](e,{leftTupleMemory:{},notMatch:new x["default"](new j["default"]).match})}function h(e,t,r,n,a,o,i){var s=o[e.p],u=i[s.constraints[0]],c=s.from,l=[],d=s.constraints.slice(1);d.forEach(function(e){var t=i[e];(m.is_instance_of_equality(t)||m.is_instance_of_reference_constraint(t))&&l.push(function(e,r){return t.assert(e,r)})});var h=e.__variables;return e=f(e,t,r,n,a,o,i),g["default"](e,{pattern:s,alias:s.a,constraints:d,__equalityConstraints:l,__variables:h,fromMemory:{},type_assert:function(e){return u.assert(e)},from_assert:function(e,t){return c.assert(e,t)}})}function p(e,t,r,n,a,o,i){var s=o[e.p],u=i[s.constraints[0]],c=s.from,l=s.constraints.slice(1),d=[];l.forEach(function(e){var t=i[e];(m.is_instance_of_equality(t)||m.is_instance_of_reference_constraint(t))&&d.push(t.assert)});var h=e.__variables;return e=f(e,t,r,n,a,o,i),g["default"](e,{pattern:s,alias:s.a,__equalityConstraints:d,__variables:h,fromMemory:{},type_assert:function(e){return u.assert(e)},from_assert:function(e,t){return c.assert(e,t)}})}function y(e,t,r,a){var o=e.ps.map(function(e){return M["default"](e,r,a)}),i=e.cs.map(function(e){return k["default"](e,r,a)}),s=e.ns.map(function(s){s=n(o,s);var u=E.get(s.tp);return u(s,e,t,r,a,o,i)});return{ns:s,ps:o,cs:i,ts:_["default"](e.ts),js:_["default"](e.js),as:_["default"](e.as),tps:_["default"](e.tps),bucket:_["default"](e.bucket)}}Object.defineProperty(r,"__esModule",{value:!0});var _=e("lodash-ts/clone"),g=e("lodash-ts/mixin"),m=e("../constraint"),v=e("../nodes"),b=e("../nodes/join-reference-node"),T=e("./rule"),k=e("./constraint"),w=e("../nodes/misc/memory"),x=e("../context"),j=e("../facts/initial"),M=e("./pattern"),E=new _map2["default"];E.set(v.nodeType.terminal,a),E.set(v.nodeType.type,o),E.set(v.nodeType.equality,i),E.set(v.nodeType.property,s),E.set(v.nodeType.alias,u),E.set(v.nodeType.leftadapter,c),E.set(v.nodeType.rightadapter,c),E.set(v.nodeType.beta,l),E.set(v.nodeType.join,f),E.set(v.nodeType.not,d),E.set(v.nodeType.exists,d),E.set(v.nodeType.from,h),E.set(v.nodeType.from_not,p),E.set(v.nodeType.exists_from,p),r["default"]=y},{"../constraint":17,"../context":18,"../facts/initial":21,"../nodes":29,"../nodes/join-reference-node":38,"../nodes/misc/memory":41,"./constraint":53,"./pattern":55,"./rule":56,"lodash-ts/clone":71,"lodash-ts/mixin":95}],55:[function(e,t,r){function n(e,t){var r=t.get(e.cls);return{tp:e.tp,id:e.id,class_type:r,a:e.a,pattern:e.pattern,constraints:e.constraints}}function a(e,t,r){var a=e.from;return e=n(e,t,r),e.from=i["default"](a,t,r),e}function o(e,t,r){var n=u.get(e.tp);return n?n(e,t,r):e}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./constraint"),s=e("../pattern"),u=new _map2["default"];u.set(s.patternType.object,n),u.set(s.patternType.initial_fact,n),u.set(s.patternType.not,n),u.set(s.patternType.exists,n),u.set(s.patternType.from,a),u.set(s.patternType.from_exists,a),u.set(s.patternType.from_not,a),r["default"]=o},{"../pattern":51,"./constraint":53}],56:[function(e,t,r){function n(e,t,r){var n=["facts","flow"];/next\(.*\)/.test(e)&&n.push("next");try{return new Function("defined, scope","return "+new Function(n.join(","),e).toString())(t,r)}catch(a){throw new Error("Invalid action : "+e+"\n"+a.message)}}function a(e,t,r){var a=n(e.action,t,r);return{n:e.n,g:e.g,p:e.p,af:e.af,pt:e.pt,fire:function(e,t){return new _promise2["default"](function(r){r(a.call(e,t.factHash,e))})}}}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a},{}],57:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./facts/fact"),a=e("./facts/initial"),o=e("./linked-list"),i=function(){function e(){_classCallCheck3["default"](this,e),this.recency=0,this.facts=new o["default"]}return _createClass3["default"](e,[{key:"dispose",value:function(){this.facts.clear()}},{key:"getFacts",value:function(){for(var e={next:this.facts.head},t=[],r=void 0;e=e.next;)(r=e.data.object)instanceof a["default"]||t.push(r);return t}},{key:"getFactsByType",value:function(e){for(var t={next:this.facts.head},r=[];t=t.next;){var n=t.data.object;n instanceof a["default"]||!(n instanceof e||n.constructor===e)||r.push(n)}return r}},{key:"getFactHandle",value:function(e){for(var t={next:this.facts.head};t=t.next;){var r=t.data;if(r.equals(e))return r}var a=new n["default"](e);return a.recency=this.recency++,a}},{key:"modifyFact",value:function(e){for(var t={next:this.facts.head};t=t.next;){var r=t.data;if(r.equals(e))return r.recency=this.recency++,r}throw new Error("the fact to modify does not exist")}},{key:"assertFact",value:function(e){var t=new n["default"](e);return t.recency=this.recency++,this.facts.push(t),t}},{key:"retractFact",value:function(e){for(var t=this.facts,r={next:t.head};r=r.next;){var n=r.data;if(n.equals(e))return t.remove(r),n}throw new Error("the fact to remove does not exist")}}]),e}();r["default"]=i},{"./facts/fact":20,"./facts/initial":21,"./linked-list":28}],58:[function(e,t,r){function n(e){return i["default"](e)||o["default"](e)}function a(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:!1,i=-1,s=e.length;r||(r=n);for(var u=[];++i<s;){var c=e[i];t>0&&r(c)?u=u.concat(t>1?a(c,t-1,r,o):c):o||(u[u.length]=c)}return u}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./isArguments"),i=e("./isArray");r["default"]=a},{"./isArguments":74,"./isArray":75}],59:[function(e,t,r){function n(e,t){return null!=e&&(i.call(e,t)||"object"==("undefined"==typeof e?"undefined":_typeof3["default"](e))&&t in e&&null===a["default"](e))}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_getPrototype"),o=Object.prototype,i=o.hasOwnProperty;r["default"]=n},{"./_getPrototype":60}],60:[function(e,t,r){function n(e){return a(Object(e))}Object.defineProperty(r,"__esModule",{value:!0});var a=_getPrototypeOf2["default"];r["default"]=n},{}],61:[function(e,t,r){function n(e){return s[e]}function a(e){return n(u.call(e))}Object.defineProperty(r,"__esModule",{value:!0});var o,i=e("./_toSource");!function(e){e[e.mapTag=0]="mapTag",e[e.objectTag=1]="objectTag",e[e.promiseTag=2]="promiseTag",e[e.setTag=3]="setTag",e[e.weakMapTag=4]="weakMapTag",e[e.dataViewTag=5]="dataViewTag",e[e.argsTag=6]="argsTag",e[e.arrayTag=7]="arrayTag",e[e.boolTag=8]="boolTag",e[e.dateTag=9]="dateTag",e[e.errorTag=10]="errorTag",e[e.funcTag=11]="funcTag",e[e.genTag=12]="genTag",e[e.numberTag=13]="numberTag",e[e.regexpTag=14]="regexpTag",e[e.stringTag=15]="stringTag",e[e.symbolTag=16]="symbolTag",e[e.arrayBufferTag=17]="arrayBufferTag",e[e.float32Tag=18]="float32Tag",e[e.float64Tag=19]="float64Tag",e[e.int8Tag=20]="int8Tag",e[e.int16Tag=21]="int16Tag",e[e.int32Tag=22]="int32Tag",e[e.uint8Tag=23]="uint8Tag",e[e.uint8ClampedTag=24]="uint8ClampedTag",e[e.uint16Tag=25]="uint16Tag",e[e.uint32Tag=26]="uint32Tag"}(o=r.enumTags||(r.enumTags={}));var s={"[object Map]":o.mapTag,"[object Object]":o.objectTag,"[object Promise]":o.promiseTag,"[object Set]":o.setTag,"[object WeakMap]":o.weakMapTag,"[object DataView]":o.dataViewTag,"[object Arguments]":o.argsTag,"[object Array]":o.arrayTag,"[object Boolean]":o.boolTag,"[object Date]":o.dateTag,"[object Error]":o.errorTag,"[object Function]":o.funcTag,"[object GeneratorFunction]":o.genTag,"[object Number]":o.numberTag,"[object RegExp]":o.regexpTag,"[object String]":o.stringTag,"[object Symbol]":o.symbolTag,"[object ArrayBuffer]":o.arrayBufferTag,"[object Float32Array]":o.float32Tag,"[object Float64Array]":o.float64Tag,"[object Int8Array]":o.int8Tag,"[object Int16Array]":o.int16Tag,"[object Int32Array]":o.int32Tag,"[object Uint8Array]":o.uint8Tag,"[object Uint8ClampedArray]":o.uint8ClampedTag,"[object Uint16Array]":o.uint16Tag,"[object Uint32Array]":o.uint32Tag};r.str2tag=n;var u=Object.prototype.toString,c=i["default"](DataView),l=i["default"](_map2["default"]),f=i["default"](_promise2["default"]),d=i["default"](_set2["default"]),h=i["default"](_weakMap2["default"]),p=function(e){return a(e)};(DataView&&p(new DataView(new ArrayBuffer(1)))!=o.dataViewTag||_map2["default"]&&p(new _map2["default"])!=o.mapTag||_promise2["default"]&&p(_promise2["default"].resolve())!=o.promiseTag||_set2["default"]&&p(new _set2["default"])!=o.setTag||_weakMap2["default"]&&p(new _weakMap2["default"])!=o.weakMapTag)&&(p=function(e){var t=a(e),r=t==o.objectTag?e.constructor:void 0,n=r?i["default"](r):void 0;if(n)switch(n){case c:return o.dataViewTag;case l:return o.mapTag;case f:return o.promiseTag;case d:return o.setTag;case h:return o.weakMapTag}return t}),r["default"]=p},{"./_toSource":70}],62:[function(e,t,r){function n(e){var t=e?e.length:void 0;if(i["default"](t)&&(o["default"](e)||s["default"](e)||a["default"](e))){for(var r=-1,n=Array(t);++r<t;)n[r]=String(r);return n}return null}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isArguments"),o=e("./isArray"),i=e("./isLength"),s=e("./isString");r["default"]=n},{"./isArguments":74,"./isArray":75,"./isLength":84,"./isString":90}],63:[function(e,t,r){function n(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],64:[function(e,t,r){function n(e,t){return t=null==t?a:t,!!t&&("number"==typeof e||o.test(e))&&e>-1&&e%1==0&&t>e}Object.defineProperty(r,"__esModule",{value:!0});var a=9007199254740991,o=/^(?:0|[1-9]\d*)$/;r["default"]=n},{}],65:[function(e,t,r){function n(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||a;return e===r}Object.defineProperty(r,"__esModule",{value:!0});var a=Object.prototype;r["default"]=n},{}],66:[function(e,t,r){function n(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],67:[function(e,t,r){function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function a(e,t){return e.map(function(e){return Array.isArray(e)?a(e,t):n(e)?o({deep:!0,inherited:t,sources:[e],target:{}}):e})}function o(e){var t=e.deep,r=e.inherited,s=e.target;for(var u in e.sources){var c=e.sources[u];if(null!==c&&void 0!==c)for(var l in c)if(r||i.call(c,l)){var f=c[l];t&&(Array.isArray(f)?f=a(f,r):n(f)&&(f=o({deep:!0,inherited:r,sources:[f],target:{}}))),s[l]=f}}return s}Object.defineProperty(r,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty;r.copyArray=a,r["default"]=o},{}],68:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=Function("return this")()},{}],69:[function(e,t,r){function n(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],70:[function(e,t,r){function n(e){if(null!=e){try{return a.call(e)}catch(t){}try{return e+""}catch(t){}}return""}Object.defineProperty(r,"__esModule",{value:!0});var a=Function.prototype.toString;r["default"]=n},{}],71:[function(e,t,r){function n(e){var t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;if(!i["default"](e))return e;var r=s["default"](e);if(r){var h=e;return h.map(function(e){return t?a(e,t):e})}if(c["default"](e)){var p=e;if(t)return p.slice();var y=new p.constructor(p.length);return p.copy(y),y}var _=u["default"](e),g=_==u.enumTags.funcTag||_==u.enumTags.genTag;if(g)return e;if(_==u.enumTags.argsTag)return e;if(_==u.enumTags.objectTag)return l["default"](e)?{}:o["default"]({deep:t,inherited:!1,sources:[e],target:{}});if(!f[_])return e;switch(_){case u.enumTags.arrayBufferTag:return n(e);case u.enumTags.boolTag:case u.enumTags.dateTag:return function(e){return new e.constructor(+e)}(e);case u.enumTags.dataViewTag:return function(e){var r=t?n(e.buffer):e.buffer;return new DataView(r,e.byteOffset,e.byteLength)}(e);case u.enumTags.float32Tag:case u.enumTags.float64Tag:case u.enumTags.int8Tag:case u.enumTags.int16Tag:case u.enumTags.int32Tag:case u.enumTags.uint8Tag:case u.enumTags.uint8ClampedTag:case u.enumTags.uint16Tag:case u.enumTags.uint32Tag:return function(e){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e);case u.enumTags.mapTag:return function(e){var r=new _map2["default"],n=!0,o=!1,i=void 0;try{for(var s,u=_getIterator3["default"](e.entries());!(n=(s=u.next()).done);n=!0){var c=s.value,l=_slicedToArray3["default"](c,2),f=l[0],d=l[1];r.set(f,a(d,t))}}catch(h){o=!0,i=h}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw i}}return r}(e);case u.enumTags.numberTag:return new Number(e);case u.enumTags.stringTag:return new String(e);case u.enumTags.regexpTag:return function(e){var t=new RegExp(e.source,d.exec(e));return t.lastIndex=e.lastIndex,t}(e);case u.enumTags.setTag:return function(e){var r=new _set2["default"],n=!0,o=!1,i=void 0;try{for(var s,u=_getIterator3["default"](e.values());!(n=(s=u.next()).done);n=!0){var c=s.value;r.add(a(c,t))}}catch(l){o=!0,i=l}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw i}}return r}(e);case u.enumTags.symbolTag:return function(e){return Object(e.valueOf())}(e);default:return e}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./_mixin"),i=e("./isObject"),s=e("./isArray"),u=e("./_getTag"),c=e("./isBuffer"),l=e("./_isHostObject"),f={};f[u.enumTags.argsTag]=f[u.enumTags.arrayTag]=f[u.enumTags.arrayBufferTag]=f[u.enumTags.dataViewTag]=f[u.enumTags.boolTag]=f[u.enumTags.dateTag]=f[u.enumTags.float32Tag]=f[u.enumTags.float64Tag]=f[u.enumTags.int8Tag]=f[u.enumTags.int16Tag]=f[u.enumTags.int32Tag]=f[u.enumTags.mapTag]=f[u.enumTags.numberTag]=f[u.enumTags.objectTag]=f[u.enumTags.regexpTag]=f[u.enumTags.setTag]=f[u.enumTags.stringTag]=f[u.enumTags.symbolTag]=f[u.enumTags.uint8Tag]=f[u.enumTags.uint8ClampedTag]=f[u.enumTags.uint16Tag]=f[u.enumTags.uint32Tag]=!0,f[u.enumTags.errorTag]=f[u.enumTags.funcTag]=f[u.enumTags.weakMapTag]=!1;var d=/\w*$/;r["default"]=a},{"./_getTag":61,"./_isHostObject":63,"./_mixin":67,"./isArray":75,"./isBuffer":79,"./isObject":87}],72:[function(e,t,r){function n(e){var t=e?e.length:0;return t?a["default"](e,o):[]}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_baseFlatten"),o=1/0;r["default"]=n},{"./_baseFlatten":58}],73:[function(e,t,r){function n(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var a=[],o=new _set2["default"](e);return o.forEach(function(e){r.every(function(t){return-1!=t.indexOf(e)})&&a.push(e)}),a}Object.defineProperty(r,"__esModule",{value:!0});Math.min;r["default"]=n},{}],74:[function(e,t,r){function n(e){return a["default"](e)&&s.call(e,"callee")&&(!c.call(e,"callee")||u.call(e)==o)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isArrayLikeObject"),o="[object Arguments]",i=Object.prototype,s=i.hasOwnProperty,u=i.toString,c=i.propertyIsEnumerable;r["default"]=n},{"./isArrayLikeObject":77}],75:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=Array.isArray},{}],76:[function(e,t,r){function n(e){return null!=e&&o["default"](e&&e.length)&&!a["default"](e)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isFunction"),o=e("./isLength");r["default"]=n},{"./isFunction":82,"./isLength":84}],77:[function(e,t,r){function n(e){return o["default"](e)&&a["default"](e)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isArrayLike"),o=e("./isObjectLike");r["default"]=n},{"./isArrayLike":76,"./isObjectLike":88}],78:[function(e,t,r){function n(e){return e===!0||e===!1||a["default"](e)&&s.call(e)==o}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isObjectLike"),o="[object Boolean]",i=Object.prototype,s=i.toString;r["default"]=n},{"./isObjectLike":88}],79:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./_root"),a=e("./stubFalse"),o="object"==("undefined"==typeof r?"undefined":_typeof3["default"](r))&&r,i=o&&"object"==("undefined"==typeof t?"undefined":_typeof3["default"](t))&&t,s=i&&i.exports===o,u=s?n["default"].Buffer:void 0,c=u?function(e){return e instanceof u}:a["default"];r["default"]=c},{"./_root":68,"./stubFalse":96}],80:[function(e,t,r){function n(e){if(s["default"](e)&&(i["default"](e)||f["default"](e)||c["default"](e.splice)||o["default"](e)||u["default"](e)))return!e.length;if(l["default"](e)){var t=a["default"](e);if(t==a.enumTags.mapTag||t==a.enumTags.setTag)return!e.size}for(var r in e)if(p.call(e,r))return!1;return!(_&&d["default"](e).length)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_getTag"),o=e("./isArguments"),i=e("./isArray"),s=e("./isArrayLike"),u=e("./isBuffer"),c=e("./isFunction"),l=e("./isObjectLike"),f=e("./isString"),d=e("./keys"),h=Object.prototype,p=h.hasOwnProperty,y=h.propertyIsEnumerable,_=!y.call({valueOf:1},"valueOf");r["default"]=n},{"./_getTag":61,"./isArguments":74,"./isArray":75,"./isArrayLike":76,"./isBuffer":79,"./isFunction":82,"./isObjectLike":88,"./isString":90,"./keys":94}],81:[function(e,t,r){function n(e,t,r){var n=e.length,a=t.length;if(n!=a)return!1;for(var o=-1,i=!0;++o<n;){var s=e[o],u=t[o];if(s!==u&&!r(s,u)){i=!1;break}}return i}function a(e,t,r,a){switch(r){case y.enumTags.dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y.enumTags.arrayBufferTag:return e.byteLength==t.byteLength&&a(new Uint8Array(e),new Uint8Array(t))?!0:!1;case y.enumTags.boolTag:case y.enumTags.dateTag:return+e==+t;case y.enumTags.errorTag:return e.name==t.name&&e.message==t.message;case y.enumTags.numberTag:return e!=+e?t!=+t:e==+t;case y.enumTags.regexpTag:case y.enumTags.stringTag:return e==t+"";case y.enumTags.mapTag:return e.size!=t.size?!1:n(h["default"](e),h["default"](t),a);case y.enumTags.setTag:return e.size!=t.size?!1:n(p["default"](e),p["default"](t),a);case y.enumTags.symbolTag:if(m)return m.call(e)==m.call(t)}return!1}function o(e,t,r){var n=_["default"](e),a=n.length,o=_["default"](t),i=o.length;if(a!=i)return!1;for(var s=a;s--;){var u=n[s];if(!(u in t))return!1}for(;++s<a;){var c=n[s],l=e[c],f=t[c];if(l!==f&&!r(l,f))return!1}return!0}function i(e,t,r){var i=l["default"](e),s=l["default"](t),u=y.enumTags.arrayTag,c=y.enumTags.arrayTag;i||(u=y["default"](e),u=u==y.enumTags.argsTag?y.enumTags.objectTag:u),s||(c=y["default"](t),c=c==y.enumTags.argsTag?y.enumTags.objectTag:c);var h=u==y.enumTags.objectTag&&!f["default"](e),p=(c==y.enumTags.objectTag&&!f["default"](t),u==c);return p&&!h?i||d["default"](e)?n(e,t,r):a(e,t,u,r):p?o(e,t,r):!1}function s(e,t){return e===t?!0:null==e||null==t||!u["default"](e)&&!c["default"](t)?e!==e&&t!==t:i(e,t,s)}Object.defineProperty(r,"__esModule",{value:!0});var u=e("./isObject"),c=e("./isObjectLike"),l=e("./isArray"),f=e("./_isHostObject"),d=e("./isTypedArray"),h=e("./_mapToArray"),p=e("./_setToArray"),y=e("./_getTag"),_=e("./keys"),g="undefined"!=typeof _symbol2["default"]?_symbol2["default"].prototype:void 0,m=g?g.valueOf:void 0;r["default"]=s},{"./_getTag":61,"./_isHostObject":63,"./_mapToArray":66,"./_setToArray":69,"./isArray":75,"./isObject":87,"./isObjectLike":88,"./isTypedArray":91,"./keys":94}],82:[function(e,t,r){function n(e){var t=a["default"](e)?c.call(e):"";return t===o||t===i||t===s}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isObject"),o="[object Function]",i="[object GeneratorFunction]",s="[object AsyncFunction]",u=Object.prototype,c=u.toString;r["default"]=n},{"./isObject":87}],83:[function(e,t,r){function n(e){var t=a["default"](e);return t&&e.constructor===Object&&!e.nodeType&&!e.setInterval}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isObject");r["default"]=n},{"./isObject":87}],84:[function(e,t,r){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&a>=e}Object.defineProperty(r,"__esModule",{value:!0});var a=9007199254740991;r["default"]=n},{}],85:[function(e,t,r){function n(e){return o["default"](e)&&a["default"](e)==a.enumTags.mapTag}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_getTag"),o=e("./isObjectLike");r["default"]=n},{"./_getTag":61,"./isObjectLike":88}],86:[function(e,t,r){function n(e){return"number"==typeof e||a["default"](e)&&s.call(e)==o}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isObjectLike"),o="[object Number]",i=Object.prototype,s=i.toString;r["default"]=n},{"./isObjectLike":88}],87:[function(e,t,r){function n(e){var t="undefined"==typeof e?"undefined":_typeof3["default"](e);return!!e&&("object"==t||"function"==t)}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],88:[function(e,t,r){function n(e){return!!e&&"object"==("undefined"==typeof e?"undefined":_typeof3["default"](e))}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],89:[function(e,t,r){function n(e){return o["default"](e)&&a["default"](e)==a.enumTags.setTag}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_getTag"),o=e("./isObjectLike");r["default"]=n},{"./_getTag":61,"./isObjectLike":88}],90:[function(e,t,r){function n(e){return"string"==typeof e||!a["default"](e)&&o["default"](e)&&u.call(e)==i}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isArray"),o=e("./isObjectLike"),i="[object String]",s=Object.prototype,u=s.toString;r["default"]=n},{"./isArray":75,"./isObjectLike":88}],91:[function(e,t,r){function n(e){return o["default"](e)&&a["default"](e&&e.length)&&!!C[L.call(e)]}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isLength"),o=e("./isObjectLike"),i="[object Arguments]",s="[object Array]",u="[object Boolean]",c="[object Date]",l="[object Error]",f="[object Function]",d="[object Map]",h="[object Number]",p="[object Object]",y="[object RegExp]",_="[object Set]",g="[object String]",m="[object WeakMap]",v="[object ArrayBuffer]",b="[object DataView]",T="[object Float32Array]",k="[object Float64Array]",w="[object Int8Array]",x="[object Int16Array]",j="[object Int32Array]",M="[object Uint8Array]",E="[object Uint8ClampedArray]",O="[object Uint16Array]",A="[object Uint32Array]",C={};C[T]=C[k]=C[w]=C[x]=C[j]=C[M]=C[E]=C[O]=C[A]=!0,C[i]=C[s]=C[v]=C[u]=C[b]=C[c]=C[l]=C[f]=C[d]=C[h]=C[p]=C[y]=C[_]=C[g]=C[m]=!1;var q=Object.prototype,L=q.toString;r["default"]=n},{"./isLength":84,"./isObjectLike":88}],92:[function(e,t,r){function n(e){return o["default"](e)&&a["default"](e)==a.enumTags.weakMapTag}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_getTag"),o=e("./isObjectLike");r["default"]=n},{"./_getTag":61,"./isObjectLike":88}],93:[function(e,t,r){function n(e){return a["default"](e)&&s.call(e)==o}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./isObjectLike"),o="[object WeakSet]",i=Object.prototype,s=i.toString;r["default"]=n},{"./isObjectLike":88}],94:[function(e,t,r){function n(e){return p(Object(e))}function a(e){if(l["default"](e)){var t=[];return e.forEach(function(e,r){t.push(r)}),t}if(d["default"](e)){var r=[];return e.forEach(function(e,t){r.push(t)}),r}if(f["default"](e)||h["default"](e))return console.warn("could not get keys from weakmap or weakwet."),[];var a=c["default"](e);if(!a&&!s["default"](e))return n(e);var p=i["default"](e),y=!!p,_=p||[],g=_.length;for(var m in e)!o["default"](e,m)||y&&("length"==m||u["default"](m,g))||a&&"constructor"==m||_.push(m);return _}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./_baseHas"),i=e("./_indexKeys"),s=e("./isArrayLike"),u=e("./_isIndex"),c=e("./_isPrototype"),l=e("./isMap"),f=e("./isWeakMap"),d=e("./isSet"),h=e("./isWeakSet"),p=_keys4["default"];r["default"]=a},{"./_baseHas":59,"./_indexKeys":62,"./_isIndex":64,"./_isPrototype":65,"./isArrayLike":76,"./isMap":85,"./isSet":89,"./isWeakMap":92,"./isWeakSet":93}],95:[function(e,t,r){function n(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return a["default"]({deep:!1,inherited:!0,sources:t,target:{}})}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./_mixin");r["default"]=n},{"./_mixin":67}],96:[function(e,t,r){function n(){return!1}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=n},{}],97:[function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function i(){y&&h&&(y=!1,h.length?p=h.concat(p):_=-1,p.length&&s())}function s(){if(!y){var e=a(i);y=!0;for(var t=p.length;t;){for(h=p,p=[];++_<t;)h&&h[_].run();_=-1,t=p.length}h=null,y=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,d=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var h,p=[],y=!1,_=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new u(e,t)),1!==p.length||y||a(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(){return[]},d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}]},{},[24])(24)});